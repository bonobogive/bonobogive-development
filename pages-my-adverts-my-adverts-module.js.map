{"version":3,"sources":["./src/app/pages/my-adverts/my-adverts.module.ts","./src/app/pages/my-adverts/my-adverts.page.ts","./src/app/pages/my-adverts/my-adverts.page.html"],"names":[],"mappings":"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","file":"pages-my-adverts-my-adverts-module.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { MyAdvertsPage } from './my-adverts.page';\r\nimport { ComponentsModule } from '../../components/components.module';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: MyAdvertsPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    IonicModule,\r\n    RouterModule.forChild(routes),\r\n    ComponentsModule\r\n  ],\r\n  declarations: [MyAdvertsPage]\r\n})\r\nexport class MyAdvertsPageModule {}\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { AdvertService } from \"./../../services/advert.service\";\r\nimport { Urls } from \"../../constants/urls\";\r\nimport { AuthService } from \"../../services/auth.service\";\r\nimport { ErrorService } from \"../../services/error.service\";\r\n\r\nimport { NavController, LoadingController, AlertController, IonInfiniteScroll } from '@ionic/angular';\r\nimport { AdvertEntity, IImageModel, AdvertClient, PaginationRequest } from '../../clients/bonobogive.client';\r\n\r\n\r\n@Component({\r\n  selector: 'my-adverts',\r\n  templateUrl: './my-adverts.page.html',\r\n  styleUrls: ['./my-adverts.page.scss'],\r\n})\r\nexport class MyAdvertsPage implements OnInit {\r\n  title = \"My adverts\";\r\n  advertImages = [];\r\n  myAdverts: AdvertEntity[] = [];\r\n  showSpinner: boolean = true;\r\n  take: number = 10;\r\n  skip: number = 0;\r\n  gotAllAdverts: boolean = false;\r\n  baseUrl = Urls.baseUrl;\r\n  lastLatestMyAdvertKey: string;\r\n  loadedAllAdverts: boolean = false;\r\n  error = false;\r\n  constructor(public navController: NavController,\r\n    public auth: AuthService,\r\n    public errorService: ErrorService,\r\n    public advertService: AdvertService,\r\n    private alertController: AlertController,\r\n    private advertClient: AdvertClient) { }\r\n\r\n  ngOnInit() {\r\n\r\n  }\r\n\r\n  async refresh(refresher) {\r\n    this.lastEvaluatedKeyHash = undefined;\r\n    this.myAdverts = [];\r\n    await this.getMyAdverts();\r\n    refresher.target.complete();\r\n  }\r\n\r\n\r\n  async getMoreMyAdverts(infiniteScroll) {\r\n    if (this.loadedAllAdverts) { infiniteScroll.target.complete(); return; }\r\n    await this.getMyAdverts();\r\n    infiniteScroll.target.complete();\r\n  }\r\n\r\n  lastEvaluatedKeyHash: string = undefined;\r\n  async getMyAdverts() {\r\n    this.error = false;\r\n    console.log(this.lastEvaluatedKeyHash);\r\n    var pagination = new PaginationRequest();\r\n    pagination.take = 10;\r\n    pagination.nextRequestBlob = this.lastEvaluatedKeyHash;\r\n    this.showSpinner = true;\r\n    this.advertClient.usersAdverts(this.auth.user.uid, pagination).subscribe(async res => {\r\n      console.log(res);\r\n      this.myAdverts.push(...res.entities);\r\n      this.lastEvaluatedKeyHash = res.lastEvaluatedKeyHash;\r\n      if (!res.lastEvaluatedKeyHash) {\r\n        this.loadedAllAdverts = true;\r\n      }\r\n      \r\n    }, \r\n    error => {\r\n      this.error = true;\r\n      console.log(\"error getting my adverts\", error);\r\n    }).add(()=>{\r\n      this.showSpinner = false;\r\n    });\r\n\r\n  }\r\n\r\n\r\n  async deleteAdvert(advert: AdvertEntity) {\r\n    this.showSpinner = true;\r\n\r\n    this.advertClient.delete(advert.partitionKey, advert.sortKey).subscribe(res => {\r\n      this.showSpinner = false;\r\n      var index = this.myAdverts.findIndex(x=>x.partitionKey === advert.partitionKey);\r\n      this.myAdverts.splice(index, 1);\r\n    });\r\n  }\r\n\r\n  async presentDeleteAlertConfirm(advert: AdvertEntity) {\r\n    const alert = await this.alertController.create({\r\n      header: `Are you sure you want to delete ${advert.title}`,\r\n      message: 'You are about to delete this advert forever, are you sure you want to continue? There is no going back!',\r\n      buttons: [\r\n        {\r\n          text: 'Cancel',\r\n          role: 'cancel',\r\n          cssClass: 'secondary',\r\n          handler: (blah) => {\r\n            console.log('Confirm Cancel: blah');\r\n          }\r\n        }, {\r\n          text: 'Delete',\r\n          handler: async () => {\r\n            await this.deleteAdvert(advert);\r\n          }\r\n        }\r\n      ]\r\n    });\r\n\r\n    await alert.present();\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    this.getMyAdverts();\r\n  }\r\n\r\n\r\n  redirecToPostNewAdvert() {\r\n    this.navController.navigateRoot(\"post\");\r\n  }\r\n\r\n  loadAdvert(advertPrimaryKey: string) {\r\n    this.navController.navigateForward(\"advert/\" + advertPrimaryKey);\r\n  }\r\n\r\n\r\n}\r\n","<ion-header>\r\n  <app-topbar title=\"Adverts\"></app-topbar>\r\n</ion-header>\r\n\r\n<ion-content class=\"ion-padding\" class=\"my-adverts\">\r\n\r\n\r\n  <ion-refresher slot=\"fixed\" (ionRefresh)=\"refresh($event)\">\r\n    <ion-refresher-content></ion-refresher-content>\r\n  </ion-refresher>\r\n\r\n\r\n  <h2>My adverts</h2>\r\n  <ion-spinner *ngIf=\"showSpinner\"></ion-spinner>\r\n\r\n\r\n<div *ngIf=\"!showSpinner && myAdverts.length === 0\">You have no adverts yet!</div>\r\n\r\n\r\n  <!-- <app-adverts *ngIf=\"pagination && pagination.data.length > 0\" [showDelete]=\"true\" [enableFavourites]=\"false\"  [adverts]=\"pagination.data\" [linear]=\"true\" ></app-adverts> -->\r\n  <ng-container *ngIf=\"myAdverts\">\r\n    <ion-list *ngFor=\"let advert of myAdverts\">\r\n      <ion-item lines=\"none\">\r\n        <app-message (click)=\"loadAdvert(advert.primaryKey)\" \r\n        [imageUrl]=\"advert.images?.length > 0 ? advert.images[0].url : null\"\r\n          [title]=\"advert.title\" \r\n          [subTitle]=\"advert.description\" \r\n          [badge]=\"advert.expired ? 'expired' : (advert.draft ? 'draft' : null)\"\r\n          [messageMultiLine]=\"true\"\r\n          [square]=\"true\">\r\n        </app-message>\r\n        <ion-button fill=\"clear\" color=\"medium\" size=\"small\" slot=\"end\" (click)=\"presentDeleteAlertConfirm(advert)\">\r\n          <ion-icon name=\"trash\"></ion-icon>\r\n        </ion-button>\r\n      </ion-item>\r\n    </ion-list>\r\n\r\n  </ng-container>\r\n\r\n\r\n\r\n\r\n\r\n  <ion-infinite-scroll threshold=\"100px\" (ionInfinite)=\"getMoreMyAdverts($event)\">\r\n    <ion-infinite-scroll-content loadingSpinner=\"bubbles\" loadingText=\"Loading more adverts...\">\r\n    </ion-infinite-scroll-content>\r\n  </ion-infinite-scroll>\r\n</ion-content>"],"sourceRoot":"webpack:///"}