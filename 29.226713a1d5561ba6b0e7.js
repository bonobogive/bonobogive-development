(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{i5GC:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var i=n("Xd5C"),r=n("TYT/"),c=function(){function t(t){this.advertClient=t,this.showFooter=!0}return t.prototype.getAdvert=function(t,e){return this.advertClient.get(t,e)},t.\u0275fac=function(e){return new(e||t)(r.hc(i.b))},t.\u0275prov=r.Ub({token:t,factory:t.\u0275fac,providedIn:"root"}),t}()},sKNj:function(t,e,n){"use strict";n.r(e),n.d(e,"AdvertStatusPageModule",(function(){return j}));var i=n("Valr"),r=n("QJY3"),c=n("DUip"),o=n("c7TG"),a=n("dzgT"),s=n("p0ib"),d=n("i5GC"),u=n("lGQG"),l=n("Xd5C"),v=n("QSUi"),f=n("TYT/"),p=n("Mm/0"),h=n("5j9j"),b=function(){return(b=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},g=function(t,e,n,i){return new(n||(n=Promise))((function(r,c){function o(t){try{s(i.next(t))}catch(e){c(e)}}function a(t){try{s(i.throw(t))}catch(e){c(e)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}s((i=i.apply(t,e||[])).next())}))},y=function(t,e){var n,i,r,c,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return c={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function a(c){return function(a){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&c[0]?i.return:c[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,c[1])).done)return r;switch(i=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,i=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){o.label=c[1];break}if(6===c[0]&&o.label<r[1]){o.label=r[1],r=c;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(c);break}r[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(a){c=[6,a],i=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}};function m(t,e){1&t&&(f.dc(0,"div"),f.Zb(1,"ion-spinner"),f.cc())}function C(t,e){1&t&&(f.dc(0,"ion-label"),f.Kc(1,"Open"),f.cc())}function w(t,e){1&t&&(f.dc(0,"ion-label"),f.Kc(1,"Expired"),f.cc())}function I(t,e){if(1&t&&(f.dc(0,"ion-item"),f.dc(1,"ion-label"),f.Kc(2,"Collected"),f.cc(),f.Zb(3,"ion-radio",6),f.cc()),2&t){var n=f.pc(2);f.Mb(3),f.vc("value",n.StatusEnum.Collected)}}function K(t,e){if(1&t){var n=f.ec();f.dc(0,"ion-item"),f.dc(1,"ion-label",7),f.Kc(2,"You can remove the expiry by editing this advert"),f.cc(),f.dc(3,"ion-button",8),f.lc("click",(function(){return f.Dc(n),f.pc(2).editAdvert()})),f.Kc(4,"Edit"),f.cc(),f.cc()}}function U(t,e){if(1&t&&(f.bc(0),f.dc(1,"ion-item"),f.Zb(2,"app-message",10),f.dc(3,"ion-label"),f.Kc(4),f.cc(),f.Zb(5,"ion-radio",11),f.cc(),f.ac()),2&t){var n=e.$implicit;f.Mb(2),f.vc("title",n.name)("imageUrl",null==n?null:n.pictureUrl),f.Mb(2),f.Lc(n.name),f.Mb(1),f.wc("value",n.uid)}}function M(t,e){if(1&t){var n=f.ec();f.dc(0,"div"),f.dc(1,"h1"),f.Kc(2,"Who collected?"),f.cc(),f.dc(3,"ion-radio-group",5),f.lc("ngModelChange",(function(t){return f.Dc(n),f.pc(2).ratedUserId=t})),f.dc(4,"ion-list-header"),f.Kc(5," You have private messaged the following people "),f.cc(),f.Jc(6,U,6,4,"ng-container",9),f.cc(),f.cc()}if(2&t){var i=f.pc(2);f.Mb(3),f.vc("ngModel",i.ratedUserId),f.Mb(3),f.vc("ngForOf",i.users)}}function S(t,e){if(1&t&&(f.dc(0,"div"),f.dc(1,"h1"),f.Kc(2,"Rate user"),f.cc(),f.Zb(3,"app-rate",12),f.cc()),2&t){var n=f.pc(2);f.Mb(3),f.vc("ratedUserId",n.ratedUserId)("reviewerUserId",n.auth.user.uid)("advertId",n.advertPrimaryKey)}}function k(t,e){if(1&t){var n=f.ec();f.dc(0,"ion-list"),f.dc(1,"ion-radio-group",5),f.lc("ngModelChange",(function(t){return f.Dc(n),f.pc().status=t})),f.dc(2,"ion-item"),f.Jc(3,C,2,0,"ion-label",2),f.Jc(4,w,2,0,"ion-label",2),f.Zb(5,"ion-radio",6),f.cc(),f.dc(6,"ion-item"),f.dc(7,"ion-label"),f.Kc(8,"Closed"),f.cc(),f.Zb(9,"ion-radio",6),f.cc(),f.Jc(10,I,4,1,"ion-item",2),f.cc(),f.Jc(11,K,5,0,"ion-item",2),f.Jc(12,M,7,2,"div",2),f.Jc(13,S,4,3,"div",2),f.cc()}if(2&t){var i=f.pc();f.Mb(1),f.vc("ngModel",i.status),f.Mb(2),f.vc("ngIf",!i.isExpired),f.Mb(1),f.vc("ngIf",i.isExpired),f.Mb(1),f.vc("value",i.StatusEnum.Open),f.Mb(4),f.vc("value",i.StatusEnum.Closed),f.Mb(1),f.vc("ngIf",(null==i.users?null:i.users.length)>0),f.Mb(1),f.vc("ngIf",i.isExpired),f.Mb(1),f.vc("ngIf",i.users.length>0&&i.status==i.StatusEnum.Collected),f.Mb(1),f.vc("ngIf",(null==i.users?null:i.users.length)>0&&i.status==i.StatusEnum.Collected&&i.ratedUserId&&"00000000-0000-0000-0000-000000000000"!==i.ratedUserId)}}function x(t,e){if(1&t){var n=f.ec();f.dc(0,"ion-button",13),f.lc("click",(function(){return f.Dc(n),f.pc().confirm()})),f.Kc(1,"Save advert status"),f.cc()}}function E(t,e){if(1&t){var n=f.ec();f.dc(0,"ion-button",14),f.lc("click",(function(){return f.Dc(n),f.pc().confirm()})),f.Kc(1,"Confirm"),f.cc()}if(2&t){var i=f.pc();f.vc("disabled",!(null!=i.rateComponent&&i.rateComponent.ratingComplete))}}var A=function(){function t(t,e,n,i,r,c,o){this.activatedRoute=t,this.advertService=e,this.auth=n,this.navController=i,this.loadingController=r,this.advertClient=c,this.ratingClient=o,this.users=[],this.loading=!1,this.ratedUserId=null,this.isExpired=!1,this.StatusEnum=l.x}return t.prototype.ngOnInit=function(){this.rating=new l.u,this.rating.ratingBreakdown=new l.s},t.prototype.ionViewWillEnter=function(){var t=this;Object(a.b)(this.activatedRoute.params,this.activatedRoute.queryParams,(function(t,e){return b(b({},t),e)})).subscribe((function(e){t.advertPrimaryKey=e.id,t.advertPartitionKey=t.advertPrimaryKey.split("|")[0],t.advertSortKey=t.advertPrimaryKey.split("|")[1],t.getAdvert(t.advertPartitionKey,t.advertSortKey)}))},t.prototype.reset=function(){this.advertPrimaryKey=void 0,this.status=void 0,this.users=[],this.loading=void 0,this.selectedUser=void 0,this.advert=void 0,this.ratedUserId=void 0,this.rating=void 0},t.prototype.confirm=function(){return g(this,void 0,void 0,(function(){var t,e,n,i,r,c=this;return y(this,(function(o){switch(o.label){case 0:return[4,this.loadingController.create({message:"Please wait..."})];case 1:return[4,(t=o.sent()).present()];case 2:return o.sent(),this.status.toString()!==l.x.Collected.toString()&&(this.ratedUserId=void 0),(e=new l.y).collectedUserId=this.ratedUserId,e.sortKey=this.advert.sortKey,e.partitionKey=this.advert.partitionKey,e.status=this.status,n=this.advertClient.updateAdvertStatus(e),i=null,this.status.toString()===l.x.Collected.toString()?(i=this.rateComponent.createRatingRequest(),r=this.ratingClient.post(i),Object(s.a)(n,r).subscribe((function(t){console.log("Updated advert status to "+c.status+" and rated user "+i.ratedUserId,t)})).add((function(){return g(c,void 0,void 0,(function(){return y(this,(function(e){switch(e.label){case 0:return[4,t.dismiss()];case 1:return e.sent(),this.navController.navigateRoot("advert/"+this.advert.primaryKey),[2]}}))}))}))):this.advertClient.updateAdvertStatus(e).subscribe((function(t){console.log("Updated advert status to "+c.status,t)})).add((function(){return g(c,void 0,void 0,(function(){return y(this,(function(e){switch(e.label){case 0:return[4,t.dismiss()];case 1:return e.sent(),this.navController.navigateRoot("advert/"+this.advert.primaryKey),[2]}}))}))})),[2]}}))}))},t.prototype.getUsersAffectedByStatusChange=function(){return g(this,void 0,void 0,(function(){var t=this;return y(this,(function(e){return this.advertClient.associatedUsers(this.advert.partitionKey,this.advert.sortKey).subscribe((function(e){console.log("Associated users",e),t.users=e})),[2]}))}))},t.prototype.editAdvert=function(){this.navController.navigateForward("post/"+this.advert.partitionKey)},t.prototype.getAdvert=function(t,e){return g(this,void 0,void 0,(function(){var n=this;return y(this,(function(i){return this.loading=!0,this.advertService.getAdvert(t,e).subscribe((function(t){return g(n,void 0,void 0,(function(){return y(this,(function(e){return this.status=t.status,this.loading=!1,this.advert=t,this.isExpired=this.advert.expired,t.collectedUserId&&(this.ratedUserId=t.collectedUserId),this.getUsersAffectedByStatusChange(),[2]}))}))})),[2]}))}))},t.\u0275fac=function(e){return new(e||t)(f.Yb(c.a),f.Yb(d.a),f.Yb(u.a),f.Yb(o.db),f.Yb(o.ab),f.Yb(l.b),f.Yb(l.t))},t.\u0275cmp=f.Sb({type:t,selectors:[["app-advert-status"]],viewQuery:function(t,e){var n;1&t&&f.Oc(v.a,!0),2&t&&f.Bc(n=f.mc())&&(e.rateComponent=n.first)},decls:11,vars:4,consts:[["title","Advert Status"],[1,"ion-padding"],[4,"ngIf"],["expand","block","color","primary",3,"click",4,"ngIf"],["expand","block",3,"disabled","click",4,"ngIf"],[3,"ngModel","ngModelChange"],[3,"value"],[1,"ion-text-wrap"],[3,"click"],[4,"ngFor","ngForOf"],[3,"title","imageUrl"],["slot","end",3,"value"],[3,"ratedUserId","reviewerUserId","advertId"],["expand","block","color","primary",3,"click"],["expand","block",3,"disabled","click"]],template:function(t,e){1&t&&(f.dc(0,"ion-header"),f.Zb(1,"app-topbar",0),f.cc(),f.dc(2,"ion-content",1),f.dc(3,"h1"),f.Kc(4,"Change advert status"),f.cc(),f.Jc(5,m,2,0,"div",2),f.dc(6,"div"),f.Jc(7,k,14,9,"ion-list",2),f.dc(8,"div"),f.Jc(9,x,2,0,"ion-button",3),f.Jc(10,E,2,1,"ion-button",4),f.cc(),f.cc(),f.cc()),2&t&&(f.Mb(5),f.vc("ngIf",e.loading),f.Mb(2),f.vc("ngIf",!e.loading&&e.advert),f.Mb(2),f.vc("ngIf",e.status!==e.StatusEnum.Collected),f.Mb(1),f.vc("ngIf",e.status===e.StatusEnum.Collected))},directives:[o.s,p.a,o.p,i.l,o.S,o.A,o.F,o.ib,r.h,r.k,o.y,o.E,o.gb,o.z,o.j,o.B,i.k,h.a,v.a],styles:[""]}),t}(),J=n("iTUp"),Y=n("j1ZV"),P=n("flA7"),O=[{path:"",component:A}],j=function(){function t(){}return t.\u0275mod=f.Wb({type:t}),t.\u0275inj=f.Vb({factory:function(e){return new(e||t)},imports:[[i.c,r.e,o.Y,c.k.forChild(O),Y.a,J.a,P.b]]}),t}()}}]);