{"version":3,"sources":["./src/app/pages/favourites/favourites.module.ts","./src/app/pages/favourites/favourites.page.ts","./src/app/pages/favourites/favourites.page.html"],"names":[],"mappings":"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","file":"pages-favourites-favourites-module.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { FavouritesPage } from './favourites.page';\r\nimport { ComponentsModule } from '../../components/components.module';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: FavouritesPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    IonicModule,\r\n    RouterModule.forChild(routes),\r\n    ComponentsModule\r\n  ],\r\n  declarations: [FavouritesPage]\r\n})\r\nexport class FavouritesPageModule {}\r\n","import { Component, OnInit } from '@angular/core';\r\n//import { FindAdvertsRequestModel } from \"../../models/FindAdvertsRequestModel\";\r\nimport { AlertController, LoadingController, NavController } from \"@ionic/angular\";\r\nimport { flatMap } from 'rxjs/operators';\r\nimport { AdvertClient, AdvertEntity, IImageModel, PaginationRequest } from '../../clients/bonobogive.client';\r\nimport { Urls } from \"../../constants/urls\";\r\n//Models\r\nimport { AuthService } from \"../../services/auth.service\";\r\nimport { ErrorService } from \"../../services/error.service\";\r\nimport { FavouriteService } from \"./../../services/favourite.service\";\r\n\r\n\r\n\r\n\r\n@Component({\r\n  selector: 'app-favourites',\r\n  templateUrl: './favourites.page.html',\r\n  styleUrls: ['./favourites.page.scss'],\r\n})\r\nexport class FavouritesPage implements OnInit {\r\n  title = \"Favourties\";\r\n  showSpinner = false;\r\n  showDelete = false;\r\n  showFavourites = true;\r\n  take = 10;\r\n\r\n  advertSlotPosition = \"start\";\r\n  loadedAllFavourites = false;\r\n\r\n  constructor(public navController: NavController,\r\n    public auth: AuthService,\r\n    public loadingCtrl: LoadingController,\r\n    public alertCtrl: AlertController,\r\n    public errorService: ErrorService,\r\n    public favouritesService: FavouriteService,\r\n    private advertClient: AdvertClient\r\n  ) { \r\n    console.log(\"my favourties page loading\");\r\n    this.getFavourites(null, null); \r\n}\r\n\r\n  ngOnInit() {\r\n   \r\n  }\r\n\r\n  baseUrl = Urls.baseUrl;\r\n\r\n  adverts: AdvertEntity[] = [];\r\n\r\n\r\n\r\n  async showDeleteFavouriteConfirm(advert: AdvertEntity) {\r\n    let confirm = await this.alertCtrl.create({\r\n      header: \"Delete favourite?\",\r\n      message: \"Are you sure you want to delete this favourite?\",\r\n      buttons: [\r\n        {\r\n          text: \"Yes\",\r\n          handler: async () => {\r\n            this.deleteFavourite(advert);\r\n          }\r\n        },\r\n        {\r\n          text: \"No\",\r\n          handler: () => {\r\n            console.log(\"Agree clicked\");\r\n          }\r\n        }\r\n      ]\r\n    });\r\n    await confirm.present();\r\n  }\r\n\r\n  removeAdvertById(primaryKey: string) {\r\n    var filteredAdverts = this.adverts.filter(x=>x.primaryKey !== primaryKey);\r\n    console.log(\"filtered adverts\", filteredAdverts);\r\n    this.adverts = filteredAdverts;\r\n  }\r\n\r\n\r\n  async deleteFavourite(advert: AdvertEntity) {\r\n    this.removeAdvertById(advert.primaryKey);\r\n    this.favouritesService.deleteFavouriteByAdvertEntity(advert).subscribe(res => {\r\n\r\n    }, err => {\r\n      console.log(err);\r\n    });\r\n  }\r\n\r\n  openFavourite(advert: AdvertEntity) {\r\n    this.navController.navigateForward(\"advert/\" + advert.primaryKey);\r\n  }\r\n  nextRequestBlob: string = undefined;\r\n\r\n  async getFavourites(refresher, infiniteScroll) {\r\n    var pagination = new PaginationRequest();\r\n    this.showSpinner = true;\r\n    pagination.take = 10;\r\n    pagination.nextRequestBlob = this.nextRequestBlob;\r\n\r\n    // if(this.favouritesService.userFavouriteAdvertIds) {\r\n    //   this.advertClient.getAverts(this.favouritesService.userFavouriteAdvertIds.map(x=>x.entityPrimaryKey)).subscribe(res => {\r\n    //     this.adverts = res.entities;\r\n         \r\n    //   }).add(()=> {\r\n    //     this.showSpinner = false;\r\n    //     if(refresher)\r\n    //       refresher.target.complete();\r\n\r\n    //       if(infiniteScroll)\r\n    //         infiniteScroll.target.complete();\r\n    //   });\r\n    // } else {\r\n      this.advertClient.favouritesAdverts(this.auth.user.uid, pagination).pipe(flatMap(x => \r\n        this.advertClient.getAverts(x.entities.map(m=>m.entityPrimaryKey))\r\n      )).subscribe(res => this.adverts = res.entities).add(()=> {\r\n        this.showSpinner = false;\r\n        if(refresher)\r\n          refresher.target.complete();\r\n\r\n          if(infiniteScroll)\r\n            infiniteScroll.target.complete();\r\n      });\r\n //   }\r\n\r\n  }\r\n\r\n\r\n  ngAfterViewInit() {\r\n   \r\n\r\n  }\r\n\r\n  async refresh(refresher) {\r\n    this.loadedAllFavourites = false;\r\n    this.nextRequestBlob = undefined;\r\n    this.adverts = [];\r\n    await this.getFavourites(refresher, null);\r\n\r\n  \r\n\r\n  }\r\n\r\n  getMore(infiniteScroll) {\r\n    this.getFavourites(null, infiniteScroll);\r\n  }\r\n\r\n\r\n  redirecToPostNewAdvert() {\r\n    this.navController.navigateRoot(\"Post\");\r\n  }\r\n\r\n  loadAdvert(ev: any, id: number) {\r\n    this.navController.navigateRoot(\"Advert/\" + id);\r\n  }\r\n\r\n}\r\n","<ion-header>\r\n  <app-topbar title=\"Favourites\"></app-topbar>\r\n</ion-header>\r\n\r\n<ion-content class=\"ion-padding\" class=\"favourites\">\r\n\r\n  <div *ngIf=\"!auth.user\">Please sign in</div>\r\n  <div *ngIf=\"auth.user\">\r\n    <ion-refresher (ionRefresh)=\"refresh($event)\" slot=\"fixed\">\r\n      <ion-refresher-content></ion-refresher-content>\r\n    </ion-refresher>\r\n\r\n    <h2>My favourites</h2>\r\n    <ion-spinner *ngIf=\"showSpinner\"></ion-spinner>\r\n    <!-- <app-adverts *ngIf=\"adverts && adverts.length > 0\" [enableFavourites]=\"showFavourites\" [adverts]=\"adverts\" [showDelete]=\"showDelete\"\r\n      [linear]=\"true\"></app-adverts> -->\r\n    <p *ngIf=\"!showSpinner && adverts && adverts.length === 0\">You have no favourites <ion-icon name=\"heart\"\r\n        style=\"color: red;\"> </ion-icon>\r\n    </p>\r\n\r\n    <ion-list *ngFor=\"let advert of adverts\">\r\n      <ion-item class=\"ion-no-padding\" lines=\"none\">\r\n        <app-message [square]=\"true\" (click)=\"openFavourite(advert)\"\r\n          [imageUrl]=\"advert.images?.length > 0 ? advert.images[0]?.url : null\" [title]=\"advert.title\"\r\n          [subTitle]=\"advert.description\" [messageMultiLine]=\"true\">\r\n        </app-message>\r\n        <!-- <ion-icon name=\"heart\" style=\"color:red; font-size:2em;\" slot=\"end\" (click)=\"showDeleteFavouriteConfirm(advert)\"></ion-icon> -->\r\n        <ion-button slot=\"end\" fill=\"clear\" color=\"danger\" size=\"large\" (click)=\"deleteFavourite(advert)\">\r\n          <ion-icon name=\"heart\"></ion-icon>\r\n        </ion-button>\r\n      </ion-item>\r\n\r\n    </ion-list>\r\n\r\n  </div>\r\n\r\n\r\n  <ion-infinite-scroll threshold=\"100px\" (ionInfinite)=\"getMore($event)\">\r\n    <ion-infinite-scroll-content loadingSpinner=\"bubbles\" loadingText=\"Loading more adverts...\">\r\n    </ion-infinite-scroll-content>\r\n  </ion-infinite-scroll>\r\n\r\n</ion-content>"],"sourceRoot":"webpack:///"}