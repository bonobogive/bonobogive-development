{"version":3,"sources":["./src/app/pages/search/search.module.ts","./src/app/pages/search/search.page.ts","./src/app/pages/search/search.page.html"],"names":[],"mappings":"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","file":"pages-search-search-module.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { SearchPage } from './search.page';\r\nimport { ComponentsModule } from '../../components/components.module';\r\nimport { HttpClientModule } from '@angular/common/http';\r\nimport { NgProgressModule } from '@ngx-progressbar/core';\r\n\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: SearchPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    IonicModule,\r\n    RouterModule.forChild(routes),\r\n    ComponentsModule\r\n  ],\r\n  declarations: [SearchPage],\r\n  providers : [  HttpClientModule,\r\n    NgProgressModule\r\n    ]\r\n})\r\nexport class SearchPageModule {}\r\n","import { Location } from \"@angular/common\";\r\nimport { Component, ElementRef, OnInit, ViewChild } from \"@angular/core\";\r\nimport { ActivatedRoute } from \"@angular/router\";\r\nimport { IonSearchbar, MenuController, NavController, ToastController, IonRefresher } from \"@ionic/angular\";\r\nimport { combineLatest } from \"rxjs\";\r\nimport { CategoryModel, SearchSortByModel, SortByEnum } from \"../../clients/bonobogive.client\";\r\nimport { AdvertsComponent } from \"../../components/adverts/adverts.component\";\r\nimport { SearchService } from \"../../services/search.service\";\r\nimport { AuthService } from \"./../../services/auth.service\";\r\n\r\n\r\n@Component({\r\n  selector: \"app-search\",\r\n  templateUrl: \"./search.page.html\",\r\n  styleUrls: [\"./search.page.scss\"],\r\n})\r\nexport class SearchPage implements OnInit {\r\n  @ViewChild(\"advertsComponent\") advertsComponent: AdvertsComponent;\r\n  readyToFetchMore: boolean = true;\r\n  categories: CategoryModel[];\r\n  sortByOptions: SearchSortByModel[];\r\n  distance: number = 50;\r\n  SortByEnum = SortByEnum;\r\n\r\n\r\n  constructor(\r\n    public searchService: SearchService,\r\n    public auth: AuthService,\r\n    public menuCtrl: MenuController,\r\n    private location: Location, private activatedRoute: ActivatedRoute, private navController: NavController,\r\n    public toastController: ToastController,\r\n  ) {\r\n\r\n  }\r\n\r\n  async init() {\r\n    this.searchService.search(null, null);\r\n  }\r\n\r\n  ngOnInit() {\r\n\r\n    this.init();\r\n\r\n  }\r\n\r\n  async refresh(refresher: IonRefresher) {\r\n    this.searchService.searchResults = [];\r\n    this.searchService.searchPageSearchRequest.from = 0;\r\n    this.searchService.noMoreResults = false;\r\n    await this.searchService.search(refresher, null);\r\n  };\r\n\r\n  async reset() {\r\n    this.searchService.refreshSearchParameters();\r\n    this.searchService.refreshSearchResults();\r\n    this.searchService.search(null, null);\r\n  }\r\n\r\n  async presentDistanceToast(initialDistance: number) {\r\n    const toast = await this.toastController.create({\r\n      message: `${initialDistance} miles returned no results, trying again with no limit`,\r\n      duration: 4000\r\n    });\r\n    toast.present();\r\n  }\r\n\r\n\r\n  async filterSearch(event) {\r\n    var distance = event.detail.value;\r\n    this.searchService.searchPageSearchRequest.distanceMiles = distance;\r\n\r\n    this.searchService.search(null, null);\r\n\r\n    console.log(this.searchService.searchPageSearchRequest.sortBy);\r\n  }\r\n\r\n\r\n  onCancel() {\r\n    console.log(\"cancel\");\r\n\r\n    this.location.back();\r\n  }\r\n\r\n  openFilter() {\r\n    this.menuCtrl.open(\"end\");\r\n  }\r\n\r\n  @ViewChild(\"searchInput\", { read: ElementRef })\r\n  input: IonSearchbar;\r\n\r\n  async ionViewDidEnter(): Promise<void> {\r\n    // this.searchService.adverts = [];\r\n    const urlParams = combineLatest(\r\n      this.activatedRoute.params,\r\n      this.activatedRoute.queryParams,\r\n      (params, queryParams) => ({ ...params, ...queryParams })\r\n    );\r\n\r\n    urlParams.subscribe(routeParams => {\r\n      var showKeyboard = routeParams[\"showKeyboard\"] === \"true\";\r\n      if (showKeyboard) {\r\n        setTimeout(() => {\r\n          this.input.setFocus();\r\n        });\r\n\r\n      }\r\n    });\r\n\r\n    setTimeout(async () => {\r\n      // await this.performSearchQuery2();\r\n    });\r\n  };\r\n\r\n  goToLogin() {\r\n    this.navController.navigateForward(\"login\");\r\n  }\r\n\r\n  goToPost() {\r\n\r\n    if (!this.auth || !this.auth.user) {\r\n      this.goToLogin();\r\n      return;\r\n    }\r\n\r\n    this.navController.navigateForward(\"post\");\r\n  }\r\n\r\n\r\n  focusSearch() {\r\n    var search = document.getElementsByClassName(\"searchbar-input\")[0];\r\n    var att = document.createAttribute(\"id\");\r\n    att.value = \"main-search-input\";\r\n    search.setAttributeNode(att);\r\n    document.getElementById(\"main-search-input\").focus();\r\n  }\r\n\r\n  getNextSearchResults(infiniteScroll) {\r\n\r\n    if (!this.searchService.noMoreResults) {\r\n      this.searchService.searchPageSearchRequest.from = this.searchService.searchPageSearchRequest.from + this.searchService.searchResults.length;\r\n      this.searchService.search(null, infiniteScroll);\r\n    }\r\n    else {\r\n      infiniteScroll.target.complete();\r\n    }\r\n\r\n  }\r\n\r\n}","<ion-header>\r\n  <app-topbar title=\"Search\"></app-topbar>\r\n</ion-header>\r\n\r\n<ion-content class=\"search\">\r\n\r\n  <ion-refresher (ionRefresh)=\"refresh($event)\" slot=\"fixed\">\r\n    <ion-refresher-content></ion-refresher-content>\r\n  </ion-refresher>\r\n\r\n  <ion-item lines=\"none\">\r\n    <ion-badge style=\"margin-top:2em;\" slot=\"start\">{{ distance }} km</ion-badge>\r\n    <ion-range min=\"1\" max=\"100\" pin=\"true\" value=\"{{distance}}\" (ionChange)=\"filterSearch($event)\" debounce=\"200\">\r\n      <ion-label slot=\"start\">1 km</ion-label>\r\n      <ion-label slot=\"end\">100 km</ion-label>\r\n    </ion-range>\r\n  </ion-item>\r\n\r\n\r\n\r\n\r\n  <ion-grid>\r\n    <ion-row>\r\n\r\n      <ion-col size=\"12\" size-sm style=\"text-align: center\">\r\n        <div class=\"logo-moto\">\r\n          <img style=\"vertical-align:middle\" style=\"padding:1em;\"\r\n            src=\"assets/images/logos/icon-text-250-side-beta.png\" />\r\n\r\n          <!-- <ion-button fill=\"clear\" size=\"small\" (click)=\"goToPost()\">Give away items for free!</ion-button> -->\r\n          <span>Give and collect free items</span>\r\n        </div>\r\n\r\n      </ion-col>\r\n\r\n\r\n    </ion-row>\r\n\r\n    <ion-row>\r\n      <ion-col>\r\n        <ion-button fill=\"outline\" expand=\"block\" color=\"primary\" (click)=\"goToPost()\" size=\"large\">Give</ion-button>\r\n      </ion-col>\r\n      <ion-col>\r\n        <ion-button fill=\"outline\" expand=\"block\" color=\"secondary\" size=\"large\" (click)=\"focusSearch()\">Search\r\n        </ion-button>\r\n      </ion-col>\r\n    </ion-row>\r\n\r\n    <ion-row>\r\n      <ion-col size=\"12\" size-sm>\r\n        <ion-button fill=\"clear\" size=\"small\" (click)=\"openFilter()\" style=\"float:right;\" class=\"sort-button\">\r\n          <span style=\"font-weight:bold;\">Sort: </span>\r\n\r\n\r\n\r\n          <span style=\" text-decoration:underline\"> {{SortByEnum[searchService.searchPageSearchRequest.sortBy]}}</span>\r\n\r\n          <ion-icon class=\"filter-options-icon\" name=\"options\"></ion-icon>\r\n        </ion-button>\r\n      </ion-col>\r\n    </ion-row>\r\n  </ion-grid>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  <ion-spinner *ngIf=\"searchService.searchSpinner\" name=\"dots\"></ion-spinner>\r\n\r\n  <app-adverts *ngIf=\"searchService.searchResults\" [adverts]=\"searchService.searchResults\" [enableFavourites]=\"true\">\r\n  </app-adverts>\r\n\r\n  <p class=\"ion-padding\" *ngIf=\"searchService.error\">Sorry, something wen't wrong...</p>\r\n\r\n  <p class=\"ion-padding\"\r\n    *ngIf=\"!searchService.searchSpinner && (!searchService.searchResults || searchService.searchResults.length === 0) && !searchService.error\">\r\n    No results, try\r\n    expanding\r\n    your filter</p>\r\n\r\n  <ion-infinite-scroll (ionInfinite)=\"getNextSearchResults($event)\">\r\n    <ion-infinite-scroll-content loadingText=\"Loading more adverts...\"></ion-infinite-scroll-content>\r\n  </ion-infinite-scroll>\r\n\r\n\r\n</ion-content>"],"sourceRoot":"webpack:///"}