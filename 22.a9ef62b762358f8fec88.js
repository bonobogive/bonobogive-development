(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{"5j9j":function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var i=n("TYT/"),r=n("c7TG"),a=n("Valr");function o(e,t){if(1&e&&i.Zb(0,"ion-img",7),2&e){var n=i.pc(2);i.vc("src",n.imageUrl)}}function c(e,t){if(1&e&&i.Zb(0,"ion-icon",8),2&e){var n=i.pc(2);i.vc("name",n.iconName)("color",n.focus?"dark":"medium")}}function s(e,t){if(1&e&&(i.dc(0,"ion-avatar",4),i.Jc(1,o,1,1,"ion-img",5),i.Jc(2,c,1,2,"ion-icon",6),i.cc()),2&e){var n=i.pc();i.wc("slot",n.avatarSlot),i.Mb(1),i.vc("ngIf",n.imageUrl),i.Mb(1),i.vc("ngIf",n.iconName)}}function l(e,t){if(1&e&&i.Zb(0,"ion-img",7),2&e){var n=i.pc(2);i.vc("src",n.imageUrl)}}function u(e,t){if(1&e&&i.Zb(0,"ion-icon",8),2&e){var n=i.pc(2);i.vc("name",n.iconName)("color",n.focus?"dark":"medium")}}function h(e,t){if(1&e&&(i.dc(0,"ion-thumbnail",4),i.Jc(1,l,1,1,"ion-img",5),i.Jc(2,u,1,2,"ion-icon",6),i.cc()),2&e){var n=i.pc();i.wc("slot",n.avatarSlot),i.Mb(1),i.vc("ngIf",n.imageUrl),i.Mb(1),i.vc("ngIf",n.iconName)}}function g(e,t){if(1&e&&(i.dc(0,"ion-badge",13),i.Kc(1),i.cc()),2&e){var n=i.pc(3);i.Mb(1),i.Lc(n.badge)}}function f(e,t){if(1&e&&(i.dc(0,"h2",11),i.Jc(1,g,2,1,"ion-badge",12),i.Kc(2),i.cc()),2&e){var n=i.pc(2);i.Mb(1),i.vc("ngIf",n.badge),i.Mb(1),i.Mc(" ",n.title," ")}}function d(e,t){if(1&e&&(i.dc(0,"h3"),i.Kc(1),i.cc()),2&e){var n=i.pc(2);i.Mb(1),i.Lc(n.subTitle)}}function p(e,t){if(1&e&&(i.dc(0,"h4"),i.Kc(1),i.cc()),2&e){var n=i.pc(2);i.Mb(1),i.Lc(n.tinyTitle)}}function m(e,t){if(1&e&&(i.dc(0,"p"),i.Kc(1),i.cc()),2&e){var n=i.pc(2);i.Mb(1),i.Lc(n.message)}}function v(e,t){if(1&e&&(i.dc(0,"small"),i.Kc(1),i.qc(2,"date"),i.qc(3,"date"),i.cc()),2&e){var n=i.pc(2);i.Mb(1),i.Nc("",i.sc(2,2,n.dateTime,"shortTime")," ",i.sc(3,5,n.dateTime,"shortDate"),"")}}function b(e,t){if(1&e&&(i.dc(0,"ion-label",9),i.Jc(1,f,3,2,"h2",10),i.Jc(2,d,2,1,"h3",3),i.Jc(3,p,2,1,"h4",3),i.Jc(4,m,2,1,"p",3),i.Jc(5,v,4,8,"small",3),i.cc()),2&e){var n=i.pc();i.Mb(1),i.vc("ngIf",n.title),i.Mb(1),i.vc("ngIf",n.subTitle),i.Mb(1),i.vc("ngIf",n.tinyTitle),i.Mb(1),i.vc("ngIf",n.message),i.Mb(1),i.vc("ngIf",n.dateTime)}}function y(e,t){if(1&e&&(i.dc(0,"ion-badge",13),i.Kc(1),i.cc()),2&e){var n=i.pc(3);i.Mb(1),i.Lc(n.badge)}}function M(e,t){if(1&e&&(i.dc(0,"h2",11),i.Jc(1,y,2,1,"ion-badge",12),i.Kc(2),i.cc()),2&e){var n=i.pc(2);i.Mb(1),i.vc("ngIf",n.badge),i.Mb(1),i.Mc(" ",n.title," ")}}function P(e,t){if(1&e&&(i.dc(0,"h3"),i.Kc(1),i.cc()),2&e){var n=i.pc(2);i.Mb(1),i.Lc(n.subTitle)}}function I(e,t){if(1&e&&(i.dc(0,"h4"),i.Kc(1),i.cc()),2&e){var n=i.pc(2);i.Mb(1),i.Lc(n.tinyTitle)}}function C(e,t){if(1&e&&(i.dc(0,"p",15),i.Kc(1),i.cc()),2&e){var n=i.pc(2);i.Mb(1),i.Lc(n.message)}}function w(e,t){if(1&e&&(i.dc(0,"small"),i.Kc(1),i.qc(2,"date"),i.qc(3,"date"),i.cc()),2&e){var n=i.pc(2);i.Mb(1),i.Nc("",i.sc(2,2,n.dateTime,"shortTime")," ",i.sc(3,5,n.dateTime,"shortDate"),"")}}function U(e,t){if(1&e&&(i.dc(0,"ion-label"),i.Jc(1,M,3,2,"h2",10),i.Jc(2,P,2,1,"h3",3),i.Jc(3,I,2,1,"h4",3),i.Jc(4,C,2,1,"p",14),i.Jc(5,w,4,8,"small",3),i.cc()),2&e){var n=i.pc();i.Mb(1),i.vc("ngIf",n.title),i.Mb(1),i.vc("ngIf",n.subTitle),i.Mb(1),i.vc("ngIf",n.tinyTitle),i.Mb(1),i.vc("ngIf",n.message),i.Mb(1),i.vc("ngIf",n.dateTime)}}var T=function(e,t){return{reply:e,focus:t}},k=function(){function e(){this.imagePositionRight=!1,this.messageReply=!1,this.messageMultiLine=!1,this.square=!1,this.smallImage=!1,this.color=null,this.focus=!0,this.avatarSlot="start",this.replyPadding="",this.dateTime=new Date}return e.prototype.ngOnInit=function(){!0===this.imagePositionRight&&(this.avatarSlot="end"),this.dateTime=this.dateTimeInput},e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Sb({type:e,selectors:[["app-message"]],inputs:{title:"title",subTitle:"subTitle",tinyTitle:"tinyTitle",message:"message",imageUrl:"imageUrl",iconName:"iconName",imagePositionRight:"imagePositionRight",messageReply:"messageReply",messageMultiLine:"messageMultiLine",dateTimeInput:"dateTimeInput",badge:"badge",square:"square",smallImage:"smallImage",color:"color",focus:"focus",timestamp:"timestamp"},decls:5,vars:8,consts:[["lines","none",1,"ion-text-wrap",3,"ngClass"],["size","small",3,"slot",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],[4,"ngIf"],["size","small",3,"slot"],[3,"src",4,"ngIf"],["style","font-size:2em",3,"name","color",4,"ngIf"],[3,"src"],[2,"font-size","2em",3,"name","color"],[1,"ion-text-wrap"],["slot","start",4,"ngIf"],["slot","start"],["slot","end",4,"ngIf"],["slot","end"],["style","text-overflow: ellipsis; white-space: nowrap;",4,"ngIf"],[2,"text-overflow","ellipsis","white-space","nowrap"]],template:function(e,t){1&e&&(i.dc(0,"ion-item",0),i.Jc(1,s,3,3,"ion-avatar",1),i.Jc(2,h,3,3,"ion-thumbnail",1),i.Jc(3,b,6,5,"ion-label",2),i.Jc(4,U,6,5,"ion-label",3),i.cc()),2&e&&(i.vc("ngClass",i.zc(5,T,t.messageReply,t.focus)),i.Mb(1),i.vc("ngIf",!t.square),i.Mb(1),i.vc("ngIf",t.square),i.Mb(1),i.vc("ngIf",t.messageMultiLine),i.Mb(1),i.vc("ngIf",!t.messageMultiLine))},directives:[r.y,a.j,a.l,r.f,r.u,r.t,r.U,r.z,r.i],pipes:[a.e],styles:[".reply[_ngcontent-%COMP%]{margin-left:2em}h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], p[_ngcontent-%COMP%], small[_ngcontent-%COMP%]{padding:0;margin:0}h2[_ngcontent-%COMP%]{font-size:1em}h3[_ngcontent-%COMP%]{font-size:.9em}h4[_ngcontent-%COMP%]{font-size:.7em}small[_ngcontent-%COMP%]{font-size:.6em}p[_ngcontent-%COMP%]{font-size:1em}h2[_ngcontent-%COMP%]{font-weight:0}.focus[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .focus[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .focus[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700}"]}),e}()},"Mm/0":function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var i=n("lGQG"),r=n("l3hs"),a=n("c7TG"),o=n("a/9d"),c=n("M2ZX"),s=n("nUpg"),l=n("TYT/"),u=n("DUip"),h=n("Valr"),g=n("QJY3"),f=["removeFocusInput"];function d(e,t){1&e&&l.Zb(0,"ion-back-button",11)}function p(e,t){1&e&&(l.dc(0,"span",12),l.Kc(1,"\ud83d\udd34"),l.cc())}var m=function(){function e(e,t,n,i,r,a,o,c,s,l,u){this.events=e,this.searchService=t,this.auth=n,this.camera=i,this.platform=r,this.nativeStorage=a,this.menuCtrl=o,this.router=c,this.navCtrl=s,this.toastController=l,this.webSocketNotificationService=u,this.isApp=!1,this.isSearchPage=!1,this.placeholder='try "table"',this.placeholders=["Search - it's all free!"],this.isApp=!this.platform.is("desktop")}return e.prototype.ngOnInit=function(){this.isSearchPage=!!this.isSamePage("/search"),this.randomPlaceHolder()},e.prototype.randomPlaceHolder=function(){var e=this.placeholders[Math.floor(Math.random()*this.placeholders.length)];this.placeholder=e},e.prototype.uploadImage=function(e){console.log("image chosen")},e.prototype.goToPost=function(){this.navCtrl.navigateForward("post")},e.prototype.openMainMenu=function(){this.menuCtrl.open("start")},e.prototype.goToIntroduction=function(){this.navCtrl.navigateForward("introduction")},e.prototype.search=function(e){e.target.blur(),this.isSamePage("search")||this.navCtrl.navigateForward("search"),e.target.value&&(this.searchService.refreshSearchResults(),this.searchService.searchPageSearchRequest.searchQuery=e.target.value,this.searchService.search(null,null))},e.prototype.isSamePage=function(e){return this.router.url===e&&(console.log("same page"),!0)},e.prototype.openNotifications=function(){this.auth&&this.auth.user?this.navCtrl.navigateForward("notifications"):this.goToLogin()},e.prototype.goToRegister=function(){this.navCtrl.navigateForward("register")},e.prototype.goToLogin=function(){this.navCtrl.navigateForward("login")},e.prototype.redirectToSearch=function(e){this.removeFocusInput.nativeElement.focus().this.navCtrl.navigateForward("search/true")},e.prototype.takePicture=function(e){return t=this,void 0,i=function(){var e,t,n;return function(e,t){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(c){a=[6,c],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,(function(i){switch(i.label){case 0:if(!this.auth||!this.auth.user)return this.goToLogin(),[2];if(this.goToPost(),this.platform.is("desktop"))return this.goToPost(),[2];e={quality:50,destinationType:this.camera.DestinationType.DATA_URL,encodingType:this.camera.EncodingType.JPEG,mediaType:this.camera.MediaType.PICTURE,targetWidth:1280,targetHeight:1280,saveToPhotoAlbum:!1},i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.camera.getPicture(e)];case 2:return t=i.sent(),this.nativeStorage.setItem("latestPicture","data:image/jpeg;base64,"+t).then((function(){return console.log("Stored item!")}),(function(e){return console.error("Error storing item",e)})),this.navCtrl.navigateForward("post"),[3,4];case 3:return n=i.sent(),console.log(n),[3,4];case 4:return[2]}}))},new((n=void 0)||(n=Promise))((function(e,r){function a(e){try{c(i.next(e))}catch(t){r(t)}}function o(e){try{c(i.throw(e))}catch(t){r(t)}}function c(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(a,o)}c((i=i.apply(t,[])).next())}));var t,n,i},e.prototype.placeHolderFocus=function(){this.placeholder="try 'table'"},e.prototype.placeHolderBlur=function(){this.placeholder="Search - it's all free!"},e.\u0275fac=function(t){return new(t||e)(l.Yb(a.d),l.Yb(r.a),l.Yb(i.a),l.Yb(o.a),l.Yb(a.eb),l.Yb(c.a),l.Yb(a.bb),l.Yb(u.i),l.Yb(a.db),l.Yb(a.kb),l.Yb(s.b))},e.\u0275cmp=l.Sb({type:e,selectors:[["app-topbar"]],viewQuery:function(e,t){var n;1&e&&l.Oc(f,!0),2&e&&l.Bc(n=l.mc())&&(t.removeFocusInput=n.first)},inputs:{title:"title",displaySearchBar:"displaySearchBar",displayCameraIcon:"displayCameraIcon"},decls:13,vars:9,consts:[[1,"ion-no-padding"],["slot","start","fill","clear",3,"click"],["name","menu",2,"font-size","2em"],["slot","start","color","primary","defaultHref","search",4,"ngIf"],["id","main-search-bar","autofocus","","slot","start",1,"searchbar",3,"searchIcon","ngModel","showCancelButton","clearIcon","placeholder","ngModelChange","search","ionFocus","ionBlur"],["searchInput",""],["type","hidden",2,"display","none"],["removeFocusInput",""],["slot","end","fill","clear",1,"ion-no-padding",3,"click"],[1,"ion-no-padding",3,"src"],["class","new-notification-position",4,"ngIf"],["slot","start","color","primary","defaultHref","search"],[1,"new-notification-position"]],template:function(e,t){1&e&&(l.dc(0,"ion-toolbar",0),l.dc(1,"ion-button",1),l.lc("click",(function(){return t.openMainMenu()})),l.Zb(2,"ion-icon",2),l.cc(),l.Jc(3,d,1,0,"ion-back-button",3),l.dc(4,"ion-searchbar",4,5),l.lc("ngModelChange",(function(e){return t.searchService.searchPageSearchRequest.searchQuery=e}))("search",(function(e){return t.search(e)}))("ionFocus",(function(){return t.placeHolderFocus()}))("ionBlur",(function(){return t.placeHolderBlur()})),l.cc(),l.Zb(6,"input",6,7),l.dc(8,"ion-button",8),l.lc("click",(function(e){return t.takePicture(e)})),l.Zb(9,"ion-icon",9),l.cc(),l.dc(10,"ion-button",8),l.lc("click",(function(){return t.openNotifications()})),l.Zb(11,"ion-icon",9),l.Jc(12,p,2,0,"span",10),l.cc(),l.cc()),2&e&&(l.Mb(3),l.vc("ngIf",!t.isSearchPage),l.Mb(1),l.vc("searchIcon","menu")("ngModel",t.searchService.searchPageSearchRequest.searchQuery)("showCancelButton",!1)("clearIcon","true")("placeholder",t.placeholder),l.Mb(5),l.vc("src","/assets/icon/menu/post-advert.svg"),l.Mb(2),l.vc("src","/assets/icon/menu/notification.svg"),l.Mb(1),l.vc("ngIf",t.webSocketNotificationService.newNotifictions))},directives:[a.X,a.j,a.t,h.l,a.L,a.jb,g.h,g.k,a.g,a.h],styles:[".title[_ngcontent-%COMP%]{color:var(--ion-color-primary);line-height:1em;font-size:.8em}.offline[_ngcontent-%COMP%]{background-color:var(--ion-color-danger);color:var(--ion-color-danger-contrast);text-transform:uppercase;text-align:center;font-size:.8em}.new-notification-position[_ngcontent-%COMP%]{position:absolute;right:1.5em;top:.5em;font-size:.7em}ion-searchbar[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{display:none!important}ion-icon.custom[_ngcontent-%COMP%]{font-size:2em;color:var(--ion-color-primary)!important;-webkit-filter:brightness(0) saturate(100%) invert(31%) sepia(30%) saturate(3312%) hue-rotate(131deg) brightness(99%) contrast(101%);filter:brightness(0) saturate(100%) invert(31%) sepia(30%) saturate(3312%) hue-rotate(131deg) brightness(99%) contrast(101%)}.searchbar-search-icon[_ngcontent-%COMP%]{display:none!important}"]}),e}()},wwmJ:function(e,t,n){"use strict";n.r(t),n.d(t,"ChatPageModule",(function(){return L}));var i=n("Valr"),r=n("QJY3"),a=n("DUip"),o=n("c7TG"),c=n("26FU"),s=n("dzgT"),l=n("Xd5C"),u=n("lGQG"),h=n("9vc0"),g=n("TYT/"),f=n("Mm/0"),d=n("5j9j"),p=function(){return(p=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},m=function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{s(i.next(e))}catch(t){a(t)}}function c(e){try{s(i.throw(e))}catch(t){a(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,c)}s((i=i.apply(e,t||[])).next())}))},v=function(e,t){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(c){a=[6,c],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},b=["conversationheader"],y=["content"],M=["conversationFooter"];function P(e,t){if(1&e){var n=g.ec();g.dc(0,"ion-avatar",23),g.dc(1,"img",24),g.lc("click",(function(){g.Dc(n);var e=g.pc();return e.goToProfile(null==e.auth||null==e.auth.user?null:e.auth.user.uid)})),g.cc(),g.cc()}if(2&e){var i=g.pc();g.Mb(1),g.wc("src",null==i.myUserProfile?null:i.myUserProfile.pictureUrl,g.Ec)}}function I(e,t){if(1&e){var n=g.ec();g.dc(0,"ion-avatar",23),g.dc(1,"img",24),g.lc("click",(function(){g.Dc(n);var e=g.pc();return e.goToProfile(null==e.theirUserProfile?null:e.theirUserProfile.uid)})),g.cc(),g.cc()}if(2&e){var i=g.pc();g.Mb(1),g.wc("src",null==i.theirUserProfile?null:i.theirUserProfile.pictureUrl,g.Ec)}}function C(e,t){if(1&e){var n=g.ec();g.dc(0,"app-message",25),g.lc("click",(function(){g.Dc(n);var e=g.pc();return e.goToProfile(null==e.auth||null==e.auth.user?null:e.auth.user.uid)})),g.cc()}if(2&e){var i=g.pc();g.vc("imageUrl",null==i.myUserProfile?null:i.myUserProfile.pictureUrl)("messageMultiLine",!1)}}function w(e,t){if(1&e){var n=g.ec();g.dc(0,"app-message",25),g.lc("click",(function(){g.Dc(n);var e=g.pc();return e.goToProfile(e.theirUserProfile.uid)})),g.cc()}if(2&e){var i=g.pc();g.vc("imageUrl",null==i.theirUserProfile?null:i.theirUserProfile.pictureUrl)("messageMultiLine",!1)}}function U(e,t){if(1&e){var n=g.ec();g.dc(0,"app-message",26),g.lc("click",(function(){g.Dc(n);var e=g.pc();return e.goToAdvert(null==e.advert?null:e.advert.partitionKey,null==e.advert?null:e.advert.sortKey)})),g.cc()}if(2&e){var i=g.pc();g.vc("square",!0)("imageUrl",i.advertImageUrl)("title",null==i.advert?null:i.advert.title)("messageMultiLine",!1)}}function T(e,t){if(1&e&&g.Zb(0,"app-message",30),2&e){var n=g.pc().$implicit,i=g.pc(2);g.vc("imageUrl",null==i.theirUserProfile?null:i.theirUserProfile.pictureUrl)("tinyTitle",null==i.theirUserProfile?null:i.theirUserProfile.name)("message",n.message.text)("focus",n)("messageMultiLine",!0)("timestamp",n.message.dateTimeUtcCreated)}}function k(e,t){if(1&e&&g.Zb(0,"app-message",31),2&e){var n=g.pc().$implicit,i=g.pc(2);g.vc("imageUrl",null==i.myUserProfile?null:i.myUserProfile.pictureUrl)("messageReply",!0)("imagePositionRight",!1)("tinyTitle",null==i.auth||null==i.auth.user?null:i.auth.user.name)("message",n.message.text)("focus",n.message.delivered)("messageMultiLine",!0)("timestamp",n)}}function S(e,t){if(1&e&&(g.dc(0,"div"),g.Jc(1,T,1,6,"app-message",28),g.Jc(2,k,1,8,"app-message",29),g.cc()),2&e){var n=t.$implicit,i=g.pc(2);g.Mb(1),g.vc("ngIf",(null==i.theirUserProfile?null:i.theirUserProfile.pictureUrl)&&(null==n.message?null:n.message.userId)===(null==i.theirUserProfile?null:i.theirUserProfile.uid)),g.Mb(1),g.vc("ngIf",(null==i.theirUserProfile?null:i.theirUserProfile.pictureUrl)&&(null==n.message?null:n.message.userId)===(null==i.auth||null==i.auth.user?null:i.auth.user.uid))}}function O(e,t){if(1&e&&(g.dc(0,"div"),g.Jc(1,S,3,2,"div",27),g.cc()),2&e){var n=g.pc();g.Ic("margin-bottom",n.conversationFooterHeight,"px"),g.Mb(1),g.vc("ngForOf",n.messages)}}function R(e,t){if(1&e){var n=g.ec();g.dc(0,"ion-button",35),g.lc("click",(function(){return g.Dc(n),g.pc(2).openAdvertStatus()})),g.Kc(1,"Update status"),g.cc()}}function K(e,t){if(1&e){var n=g.ec();g.dc(0,"ion-button",36),g.lc("click",(function(){return g.Dc(n),g.pc(2).openAdvertStatus()})),g.Kc(1),g.cc()}if(2&e){var i=g.pc(2);g.Mb(1),g.Mc("Status: ",i.StatusEnum[i.advert.status],"")}}function J(e,t){if(1&e&&(g.dc(0,"ion-toolbar",32),g.dc(1,"ion-item",4),g.Jc(2,R,2,0,"ion-button",33),g.Jc(3,K,2,1,"ion-button",34),g.cc(),g.cc()),2&e){var n=g.pc();g.Mb(2),g.vc("ngIf",(null==n.auth.user?null:n.auth.user.uid)==n.advert.userId),g.Mb(1),g.vc("ngIf",(null==n.auth.user?null:n.auth.user.uid)==n.advert.userId)}}var F=function(){function e(e,t,n,i,a,o,s,u,h,g,f,d,p){this.auth=e,this.formBuilder=t,this.errorService=n,this.loadingCtrl=i,this.navController=a,this.popoverCtrl=o,this.activatedRoute=s,this.modalController=u,this.chatClient=h,this.messageClient=g,this.authService=f,this.userClient=d,this.advertClient=p,this.title="Post Private Message",this.loadingMedia=!1,this.gotAllMessages=!1,this.messages=[],this.advertImageUrl="",this.myAdvert=!1,this.messgeInputPlaceholder="Message privately",this.take=10,this.limit=new c.a(this.take),this.showRatingsCount=!0,this.allowRating=!1,this.getReviewerRating=!0,this.readOnlyRating=!0,this.average=0,this.chatSeen=!1,this.loadingMessages=!1,this.loadingMore=!1,this.loadingChatDetails=!1,this.nextRequestBlob="",this.StatusEnum=l.x,this.postMessageForm=this.formBuilder.group({message:["",r.o.required]})}return Object.defineProperty(e.prototype,"isAdvertOwner",{get:function(){return!(!this.advert||this.advert.userId!==this.auth.user.uid)},enumerable:!0,configurable:!0}),e.prototype.messageInputFocus=function(){this.scrollToBottom()},e.prototype.messageInputBlur=function(){this.scrollToBottom()},e.prototype.ngOnInit=function(){var e=this;this.myUserProfile=this.authService.user,Object(s.b)(this.activatedRoute.params,this.activatedRoute.queryParams,(function(e,t){return p(p({},e),t)})).subscribe((function(t){t.chatId&&(e.chatPrimaryKey=t.chatId,e.loadChat(),e.advertPartitionKey=e.chatPrimaryKey.split("chat.")[1].split("|")[0],e.advertSortKey=e.chatPrimaryKey.split("|")[1],e.advertClient.get(e.advertPartitionKey,e.advertSortKey).subscribe((function(t){e.advert=t})))}))},e.prototype.loadPreviousMessages=function(e){this.loadingChatDetails||this.loadingMessages||""===this.nextRequestBlob||!this.nextRequestBlob||this.loadMessages(e),e.target.complete()},e.prototype.loadMessages=function(e){var t=this;this.loadingMessages=!0,this.messageClient.get(this.chatPrimaryKey,l.q.Private,10,this.nextRequestBlob).subscribe((function(n){return m(t,void 0,void 0,(function(){var t;return v(this,(function(i){return e&&e.target.complete(),this.nextRequestBlob=n.lastEvaluatedKeyHash,"null"!==n.lastEvaluatedKeyHash&&n.lastEvaluatedKeyHash||(this.nextRequestBlob=""),(t=this.messages).unshift.apply(t,n.messages),this.chatClient.updateUserChatSeen("chat.user-"+this.auth.user.uid,this.chatDetails.primaryKey,!0).subscribe((function(e){console.log("Updated chat user to seen",e)})),[2]}))}))})).add((function(){t.loadingMessages=!1}))},e.prototype.loadChat=function(){var e=this;this.loadingChatDetails=!0,this.chatClient.get(this.chatPrimaryKey.split("|")[0]+"|"+this.chatPrimaryKey.split("|")[1],this.chatPrimaryKey.split("|")[2]).subscribe((function(t){e.chatDetails=t;var n=e.chatDetails.userIds.find((function(t){return t!==e.authService.user.uid}));n||(n=e.chatDetails.userIds[0]),e.userClient.get(n,!0).subscribe((function(t){e.theirUserProfile=t})),e.loadMessages(null)})).add((function(){e.loadingChatDetails=!1,e.scrollToBottom()}))},e.prototype.scrollToBottom=function(){var e=this;setTimeout((function(){try{e.content&&e.content.scrollToBottom()}catch(t){}}))},e.prototype.privateMessageForm=function(){return m(this,void 0,void 0,(function(){var e,t,n=this;return v(this,(function(i){return e=this.postMessageForm.value.message,(t=new l.g).entityPrimaryKey=this.chatDetails.primaryKey,t.messageType=l.q.Private,t.text=e,t.userId=this.auth.user.uid,t.entityType=l.i.Chat,this.messageClient.post(t).subscribe((function(e){var t=new l.p;t.message=e,t.user=n.auth.user,n.messages.push(t)})).add((function(){n.postMessageForm.reset()})),[2]}))}))},e.prototype.openAdvertStatus=function(){this.navController.navigateForward("advert-status/"+this.advert.primaryKey)},e.prototype.goToProfile=function(e){this.navController.navigateForward("user-profile/"+e)},e.prototype.goToAdvert=function(e,t){this.navController.navigateForward("advert/"+e+"/"+t)},e.prototype.rateUser=function(){return m(this,void 0,void 0,(function(){var e,t;return v(this,(function(n){return t="rating?ratedUserId="+(e={reviewerUserId:this.auth.user.uid,ratedUserId:this.theirUserProfile.uid,overallaverages:!1,advertId:this.chatDetails.partitionKey,getAverageUserRating:!1,getReviewerRating:!0,readOnlyRating:!1,showRatingsCount:!1,displayname:this.theirUserProfile.name}).ratedUserId+"&reviewerUserId="+e.reviewerUserId+"&overallaverages="+e.overallaverages+"&advertId="+e.advertId+"&getAverageUserRating="+e.getAverageUserRating+"&getReviewerRating="+e.getReviewerRating+"&readOnlyRating="+e.readOnlyRating+"&showRatingsCount="+e.showRatingsCount+"&displayname="+e.displayname,console.log("Navigate to "+t),this.navController.navigateForward(t),[2]}))}))},e.\u0275fac=function(t){return new(t||e)(g.Yb(u.a),g.Yb(r.b),g.Yb(h.a),g.Yb(o.ab),g.Yb(o.db),g.Yb(o.fb),g.Yb(a.a),g.Yb(o.cb),g.Yb(l.e),g.Yb(l.n),g.Yb(u.a),g.Yb(l.z),g.Yb(l.b))},e.\u0275cmp=g.Sb({type:e,selectors:[["chat"]],viewQuery:function(e,t){var n;1&e&&(g.Oc(b,!0),g.Oc(y,!0),g.Oc(M,!0)),2&e&&(g.Bc(n=g.mc())&&(t.conversationheaderView=n.first),g.Bc(n=g.mc())&&(t.content=n.first),g.Bc(n=g.mc())&&(t.conversationFooterView=n.first))},decls:38,vars:15,consts:[["title","Chat"],[1,"chat",2,"margin-bottom","50em"],["content",""],[3,"hidden"],["lines","none"],[2,"margin-left","0.5em","margin-right","0.5em"],["class","chat-item-advert-image","slot","start",4,"ngIf"],["slot","start",1,"ion-no-padding"],[3,"imageUrl","messageMultiLine","click",4,"ngIf"],["slot","start"],["slot","start",3,"square","imageUrl","title","messageMultiLine","click",4,"ngIf"],["name","information-circle-outline",2,"font-size","2em"],["threshold","100px","position","top",3,"ionInfinite"],["loadingSpinner","bubbles","loadingText","Loading more messages..."],[3,"marginBottom",4,"ngIf"],[1,"chat-footer",3,"hidden"],["conversationFooter",""],[1,"toolbar-chatbar"],[3,"formGroup","ngSubmit"],["type","text","formControlName","message",3,"placeholder","ionFocus","ionBlur"],["fill","clear","size","large","type","submit","slot","end",3,"disabled"],["name","send"],["class","toolbar-status","class","ion-no-padding",4,"ngIf"],["slot","start",1,"chat-item-advert-image"],[2,"object-fit","cover",3,"src","click"],[3,"imageUrl","messageMultiLine","click"],["slot","start",3,"square","imageUrl","title","messageMultiLine","click"],[4,"ngFor","ngForOf"],[3,"imageUrl","tinyTitle","message","focus","messageMultiLine","timestamp",4,"ngIf"],[3,"imageUrl","messageReply","imagePositionRight","tinyTitle","message","focus","messageMultiLine","timestamp",4,"ngIf"],[3,"imageUrl","tinyTitle","message","focus","messageMultiLine","timestamp"],[3,"imageUrl","messageReply","imagePositionRight","tinyTitle","message","focus","messageMultiLine","timestamp"],[1,"ion-no-padding"],["button-default","","block","",3,"click",4,"ngIf"],["fill","clear","color","dark","button-default","","block","",3,"click",4,"ngIf"],["button-default","","block","",3,"click"],["fill","clear","color","dark","button-default","","block","",3,"click"]],template:function(e,t){1&e&&(g.dc(0,"ion-header"),g.Zb(1,"app-topbar",0),g.cc(),g.dc(2,"ion-content",1,2),g.Zb(4,"ion-spinner",3),g.dc(5,"div",3),g.dc(6,"ion-item",4),g.dc(7,"a"),g.Kc(8,"Inbox"),g.cc(),g.dc(9,"span",5),g.Kc(10,">"),g.cc(),g.Kc(11),g.cc(),g.Jc(12,P,2,1,"ion-avatar",6),g.Jc(13,I,2,1,"ion-avatar",6),g.dc(14,"div",7),g.Jc(15,C,1,2,"app-message",8),g.Jc(16,w,1,2,"app-message",8),g.cc(),g.dc(17,"ion-item",4),g.dc(18,"div",9),g.Jc(19,U,1,4,"app-message",10),g.cc(),g.cc(),g.Zb(20,"hr"),g.Zb(21,"ion-icon",11),g.dc(22,"span"),g.Kc(23,"Suggest a location, date and time for collection"),g.cc(),g.Zb(24,"br"),g.dc(25,"ion-infinite-scroll",12),g.lc("ionInfinite",(function(e){return t.loadPreviousMessages(e)})),g.Zb(26,"ion-infinite-scroll-content",13),g.cc(),g.Jc(27,O,2,3,"div",14),g.cc(),g.cc(),g.dc(28,"ion-footer",15,16),g.dc(30,"ion-toolbar",17),g.dc(31,"ion-card",3),g.dc(32,"form",18),g.lc("ngSubmit",(function(){return t.privateMessageForm()})),g.dc(33,"ion-item"),g.dc(34,"ion-input",19),g.lc("ionFocus",(function(){return t.messageInputFocus()}))("ionBlur",(function(){return t.messageInputBlur()})),g.cc(),g.dc(35,"ion-button",20),g.Zb(36,"ion-icon",21),g.cc(),g.cc(),g.cc(),g.cc(),g.cc(),g.Jc(37,J,4,2,"ion-toolbar",22),g.cc()),2&e&&(g.Mb(4),g.vc("hidden",!t.loadingChatDetails),g.Mb(1),g.vc("hidden",t.loadingChatDetails),g.Mb(6),g.Mc(" Private message with ",null==t.theirUserProfile?null:t.theirUserProfile.name,""),g.Mb(1),g.vc("ngIf",(null==t.auth||null==t.auth.user?null:t.auth.user.uid)===(null==t.advert?null:t.advert.userId)),g.Mb(1),g.vc("ngIf",(null==t.auth||null==t.auth.user?null:t.auth.user.uid)!==(null==t.advert?null:t.advert.userId)),g.Mb(2),g.vc("ngIf",(null==t.auth||null==t.auth.user?null:t.auth.user.uid)===(null==t.advert?null:t.advert.userId)),g.Mb(1),g.vc("ngIf",(null==t.auth||null==t.auth.user?null:t.auth.user.uid)!==(null==t.advert?null:t.advert.userId)),g.Mb(3),g.vc("ngIf",t.advertImageUrl),g.Mb(8),g.vc("ngIf",t.messages),g.Mb(1),g.vc("hidden",!(null!=t.chatDetails&&t.chatDetails.primaryKey)),g.Mb(3),g.vc("hidden",!t.myUserProfile),g.Mb(1),g.vc("formGroup",t.postMessageForm),g.Mb(2),g.vc("placeholder",t.messgeInputPlaceholder),g.Mb(1),g.vc("disabled",!t.postMessageForm.valid),g.Mb(2),g.vc("ngIf",t.advert&&(null==t.advert?null:t.advert.userId)==(null==t.myUserProfile?null:t.myUserProfile.uid)))},directives:[o.s,f.a,o.p,o.S,o.y,i.l,o.t,o.v,o.w,o.q,o.X,o.k,r.q,r.i,r.d,o.x,o.jb,r.h,r.c,o.j,o.f,d.a,i.k],styles:['.chat[_ngcontent-%COMP%]   .chat-item-advert-image[_ngcontent-%COMP%]{position:relative;padding:0}.chat[_ngcontent-%COMP%]   .chat-item-advert-image[_ngcontent-%COMP%]   .advert-owner-photourl[_ngcontent-%COMP%]{position:absolute;bottom:2%;padding:0;left:0;right:0;margin:auto;width:40%;height:40%;border:1px solid #fff;border-radius:50%;-o-object-fit:cover;object-fit:cover}.chat-footer[_ngcontent-%COMP%]   .toolbar-status[_ngcontent-%COMP%]{background-color:"red"}.chat-footer[_ngcontent-%COMP%]   .average-rating-container[_ngcontent-%COMP%]{background-color:#fff;display:block;margin:0;padding:.5em;font-size:1.5em}.chat-footer[_ngcontent-%COMP%]   .average-rating-container[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:1em;padding:1em}']}),e}(),_=n("j1ZV"),x=[{path:"",component:F}],L=function(){function e(){}return e.\u0275mod=g.Wb({type:e}),e.\u0275inj=g.Vb({factory:function(t){return new(t||e)},imports:[[i.c,r.e,r.m,o.Y,a.k.forChild(x),_.a]]}),e}()}}]);