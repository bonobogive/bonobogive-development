(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{Qopo:function(t,e,n){"use strict";n.r(e),n.d(e,"MyAdvertsPageModule",(function(){return k}));var r=n("Valr"),i=n("QJY3"),o=n("DUip"),s=n("c7TG"),c=n("i5GC"),a=n("AzuR"),l=n("lGQG"),u=n("9vc0"),d=n("Xd5C"),h=n("TYT/"),f=n("Mm/0"),v=n("5j9j"),p=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{a(r.next(t))}catch(e){o(e)}}function c(t){try{a(r.throw(t))}catch(e){o(e)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}a((r=r.apply(t,e||[])).next())}))},y=function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(c){o=[6,c],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}};function b(t,e){1&t&&h.Zb(0,"ion-spinner")}function g(t,e){1&t&&(h.dc(0,"div"),h.Kc(1,"You have no adverts yet!"),h.cc())}function m(t,e){if(1&t){var n=h.ec();h.dc(0,"ion-list"),h.dc(1,"ion-item",7),h.dc(2,"app-message",8),h.lc("click",(function(){h.Dc(n);var t=e.$implicit;return h.pc(2).loadAdvert(t.primaryKey)})),h.cc(),h.dc(3,"ion-button",9),h.lc("click",(function(){h.Dc(n);var t=e.$implicit;return h.pc(2).presentDeleteAlertConfirm(t)})),h.Zb(4,"ion-icon",10),h.cc(),h.cc(),h.cc()}if(2&t){var r=e.$implicit;h.Mb(2),h.vc("imageUrl",(null==r.images?null:r.images.length)>0?r.images[0].url:null)("title",r.title)("subTitle",r.description)("badge",r.expired?"expired":r.draft?"draft":null)("messageMultiLine",!0)("square",!0)}}function w(t,e){if(1&t&&(h.bc(0),h.Jc(1,m,5,6,"ion-list",6),h.ac()),2&t){var n=h.pc();h.Mb(1),h.vc("ngForOf",n.myAdverts)}}var A=function(){function t(t,e,n,r,i,o){this.navController=t,this.auth=e,this.errorService=n,this.advertService=r,this.alertController=i,this.advertClient=o,this.title="My adverts",this.advertImages=[],this.myAdverts=[],this.showSpinner=!0,this.take=10,this.skip=0,this.gotAllAdverts=!1,this.baseUrl=a.a.baseUrl,this.loadedAllAdverts=!1,this.error=!1,this.lastEvaluatedKeyHash=void 0}return t.prototype.ngOnInit=function(){},t.prototype.refresh=function(t){return p(this,void 0,void 0,(function(){return y(this,(function(e){switch(e.label){case 0:return this.lastEvaluatedKeyHash=void 0,this.myAdverts=[],[4,this.getMyAdverts()];case 1:return e.sent(),t.target.complete(),[2]}}))}))},t.prototype.getMoreMyAdverts=function(t){return p(this,void 0,void 0,(function(){return y(this,(function(e){switch(e.label){case 0:return this.loadedAllAdverts?(t.target.complete(),[2]):[4,this.getMyAdverts()];case 1:return e.sent(),t.target.complete(),[2]}}))}))},t.prototype.getMyAdverts=function(){return p(this,void 0,void 0,(function(){var t,e=this;return y(this,(function(n){return this.error=!1,console.log(this.lastEvaluatedKeyHash),(t=new d.r).take=10,t.nextRequestBlob=this.lastEvaluatedKeyHash,this.showSpinner=!0,this.advertClient.usersAdverts(this.auth.user.uid,t).subscribe((function(t){return p(e,void 0,void 0,(function(){var e;return y(this,(function(n){return console.log(t),(e=this.myAdverts).push.apply(e,t.entities),this.lastEvaluatedKeyHash=t.lastEvaluatedKeyHash,t.lastEvaluatedKeyHash||(this.loadedAllAdverts=!0),[2]}))}))}),(function(t){e.error=!0,console.log("error getting my adverts",t)})).add((function(){e.showSpinner=!1})),[2]}))}))},t.prototype.deleteAdvert=function(t){return p(this,void 0,void 0,(function(){var e=this;return y(this,(function(n){return this.showSpinner=!0,this.advertClient.delete(t.partitionKey,t.sortKey).subscribe((function(n){e.showSpinner=!1;var r=e.myAdverts.findIndex((function(e){return e.partitionKey===t.partitionKey}));e.myAdverts.splice(r,1)})),[2]}))}))},t.prototype.presentDeleteAlertConfirm=function(t){return p(this,void 0,void 0,(function(){var e=this;return y(this,(function(n){switch(n.label){case 0:return[4,this.alertController.create({header:"Are you sure you want to delete "+t.title,message:"You are about to delete this advert forever, are you sure you want to continue? There is no going back!",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(t){console.log("Confirm Cancel: blah")}},{text:"Delete",handler:function(){return p(e,void 0,void 0,(function(){return y(this,(function(e){switch(e.label){case 0:return[4,this.deleteAdvert(t)];case 1:return e.sent(),[2]}}))}))}}]})];case 1:return[4,n.sent().present()];case 2:return n.sent(),[2]}}))}))},t.prototype.ngAfterViewInit=function(){this.getMyAdverts()},t.prototype.redirecToPostNewAdvert=function(){this.navController.navigateRoot("post")},t.prototype.loadAdvert=function(t){this.navController.navigateForward("advert/"+t)},t.\u0275fac=function(e){return new(e||t)(h.Yb(s.db),h.Yb(l.a),h.Yb(u.a),h.Yb(c.a),h.Yb(s.b),h.Yb(d.b))},t.\u0275cmp=h.Sb({type:t,selectors:[["my-adverts"]],decls:12,vars:3,consts:[["title","Adverts"],[1,"my-adverts"],["slot","fixed",3,"ionRefresh"],[4,"ngIf"],["threshold","100px",3,"ionInfinite"],["loadingSpinner","bubbles","loadingText","Loading more adverts..."],[4,"ngFor","ngForOf"],["lines","none"],[3,"imageUrl","title","subTitle","badge","messageMultiLine","square","click"],["fill","clear","color","medium","size","small","slot","end",3,"click"],["name","trash"]],template:function(t,e){1&t&&(h.dc(0,"ion-header"),h.Zb(1,"app-topbar",0),h.cc(),h.dc(2,"ion-content",1),h.dc(3,"ion-refresher",2),h.lc("ionRefresh",(function(t){return e.refresh(t)})),h.Zb(4,"ion-refresher-content"),h.cc(),h.dc(5,"h2"),h.Kc(6,"My adverts"),h.cc(),h.Jc(7,b,1,0,"ion-spinner",3),h.Jc(8,g,2,0,"div",3),h.Jc(9,w,2,1,"ng-container",3),h.dc(10,"ion-infinite-scroll",4),h.lc("ionInfinite",(function(t){return e.getMoreMyAdverts(t)})),h.Zb(11,"ion-infinite-scroll-content",5),h.cc(),h.cc()),2&t&&(h.Mb(7),h.vc("ngIf",e.showSpinner),h.Mb(1),h.vc("ngIf",!e.showSpinner&&0===e.myAdverts.length),h.Mb(1),h.vc("ngIf",e.myAdverts))},directives:[s.s,f.a,s.p,s.H,s.I,r.l,s.v,s.w,s.S,r.k,s.A,s.y,v.a,s.j,s.t],styles:[""]}),t}(),M=n("j1ZV"),C=[{path:"",component:A}],k=function(){function t(){}return t.\u0275mod=h.Wb({type:t}),t.\u0275inj=h.Vb({factory:function(e){return new(e||t)},imports:[[r.c,i.e,i.m,s.Y,o.k.forChild(C),M.a]]}),t}()}}]);