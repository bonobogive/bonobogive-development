(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"+QRC":function(t,e,n){"use strict";var r=n("E9nw");t.exports=function(t,e){var n,o,i,c,a,s,u=!1;e||(e={}),n=e.debug||!1;try{if(i=r(),c=document.createRange(),a=document.getSelection(),(s=document.createElement("span")).textContent=t,s.style.all="unset",s.style.position="fixed",s.style.top=0,s.style.clip="rect(0, 0, 0, 0)",s.style.whiteSpace="pre",s.style.webkitUserSelect="text",s.style.MozUserSelect="text",s.style.msUserSelect="text",s.style.userSelect="text",s.addEventListener("copy",(function(n){n.stopPropagation(),e.format&&(n.preventDefault(),n.clipboardData.clearData(),n.clipboardData.setData(e.format,t))})),document.body.appendChild(s),c.selectNodeContents(s),a.addRange(c),!document.execCommand("copy"))throw new Error("copy command was unsuccessful");u=!0}catch(l){n&&console.error("unable to copy using execCommand: ",l),n&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(e.format||"text",t),u=!0}catch(l){n&&console.error("unable to copy using clipboardData: ",l),n&&console.error("falling back to prompt"),o=function(t){var e=(/mac os x/i.test(navigator.userAgent)?"\u2318":"Ctrl")+"+C";return t.replace(/#{\s*key\s*}/g,e)}("message"in e?e.message:"Copy to clipboard: #{key}, Enter"),window.prompt(o,t)}}finally{a&&("function"==typeof a.removeRange?a.removeRange(c):a.removeAllRanges()),s&&document.body.removeChild(s),i()}return u}},"9B06":function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n("Xd5C");var r=n("mveN"),o=n("TYT/"),i=function(){function t(t){this.favouriteService=t}return t.prototype.transform=function(t,e){return!(!this.favouriteService.userFavouriteAdvertIds||!this.favouriteService.userFavouriteAdvertIds.find((function(e){return e.entityPrimaryKey===t})))},t.\u0275fac=function(e){return new(e||t)(o.Yb(r.a))},t.\u0275pipe=o.Xb({name:"favourite",type:t,pure:!1}),t}()},E9nw:function(t,e){t.exports=function(){var t=document.getSelection();if(!t.rangeCount)return function(){};for(var e=document.activeElement,n=[],r=0;r<t.rangeCount;r++)n.push(t.getRangeAt(r));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null}return t.removeAllRanges(),function(){"Caret"===t.type&&t.removeAllRanges(),t.rangeCount||n.forEach((function(e){t.addRange(e)})),e&&e.focus()}}},SOku:function(t,e,n){"use strict";n.r(e),n.d(e,"AdvertPageModule",(function(){return ht}));var r=n("Valr"),o=n("QJY3"),i=n("DUip"),c=n("c7TG"),a=n("TYT/"),s=n("mveN"),u=n("i5GC"),l=n("lGQG"),d=n("9vc0"),p=n("AzuR"),m=n("dzgT"),v=n("/XPu"),f=n("+QRC"),g=n("mnRn"),h=n("Xd5C"),b=n("5j9j"),y=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((r=r.apply(t,e||[])).next())}))},C=function(t,e){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((o=(o=c.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},M=["commentinput"],w=["replyInputs"];function P(t,e){if(1&t&&a.Zb(0,"app-message",10),2&t){var n=a.pc(2).$implicit;a.vc("messageMultiLine",!0)("focus",!0)("messageReply",!!n.message.fullSlug)("imageUrl",null==n||null==n.user?null:n.user.pictureUrl)("title",n.user.name)("message",n.message.text)}}function O(t,e){if(1&t&&a.Zb(0,"app-message",10),2&t){var n=a.pc(2).$implicit;a.vc("messageMultiLine",!0)("focus",!0)("messageReply",!!n.message.fullSlug)("title",n.user.name)("message",n.message.text)}}function I(t,e){if(1&t){var n=a.ec();a.dc(0,"ion-button",11),a.lc("click",(function(){a.Dc(n);var t=a.pc(2).$implicit;return a.pc(2).presentReplyPopup(t)})),a.Kc(1," Reply "),a.cc()}}function k(t,e){if(1&t){var n=a.ec();a.dc(0,"ion-button",12),a.lc("click",(function(){a.Dc(n);var t=a.pc(2).$implicit;return a.pc(2).createConversation(t.message.userId)})),a.Kc(1," Arrange collection "),a.cc()}}function S(t,e){if(1&t){var n=a.ec();a.dc(0,"ion-button",12),a.lc("click",(function(){return a.Dc(n),a.pc(4).showCommentHelp()})),a.Zb(1,"ion-icon",13),a.cc()}}function _(t,e){if(1&t&&(a.dc(0,"div",4),a.dc(1,"div",5),a.Jc(2,P,1,6,"app-message",6),a.Jc(3,O,1,5,"app-message",6),a.dc(4,"div",7),a.Jc(5,I,2,0,"ion-button",8),a.Jc(6,k,2,0,"ion-button",9),a.Jc(7,S,2,0,"ion-button",9),a.cc(),a.cc(),a.cc()),2&t){var n=a.pc().$implicit,r=a.pc(2);a.Mb(1),a.vc("ngClass",n.message.fullSlug.includes("/")?"replypadding":""),a.Mb(1),a.vc("ngIf",null==n||null==n.user?null:n.user.pictureUrl),a.Mb(1),a.vc("ngIf",!(null!=n&&null!=n.user&&n.user.pictureUrl)),a.Mb(2),a.vc("ngIf",!n.message.fullSlug.includes("/")&&r.advert.status===r.StatusEnum.Open&&n.user&&r.auth.user&&r.auth.user.uid==r.advert.userId),a.Mb(1),a.vc("ngIf",r.advert.status===r.StatusEnum.Open&&n.user&&r.auth.user&&r.auth.user.uid==r.advert.userId),a.Mb(1),a.vc("ngIf",r.advert.status===r.StatusEnum.Open&&n.user&&r.auth.user&&r.auth.user.uid==r.advert.userId&&r.auth.user.uid!==n.user.uid)}}function A(t,e){if(1&t&&(a.bc(0),a.Jc(1,_,8,6,"div",3),a.ac()),2&t){var n=e.$implicit;a.Mb(1),a.vc("ngIf",n)}}function x(t,e){if(1&t&&(a.dc(0,"div",1),a.Jc(1,A,2,1,"ng-container",2),a.cc()),2&t){var n=a.pc();a.Mb(1),a.vc("ngForOf",n.advertComments)}}var F=function(){function t(t,e,n,r,o,i,c,a,s){this.navController=t,this.auth=e,this.modalCtrl=n,this.advertService=r,this.imageService=o,this.loadingController=i,this.alertController=c,this.messageClient=a,this.chatClient=s,this.avatarImageSize="3em",this.advertComments=[],this.commentUsers=[],this.StatusEnum=h.x}return t.prototype.ngOnInit=function(){},t.prototype.createConversation=function(t){return y(this,void 0,void 0,(function(){var e,n,r=this;return C(this,(function(o){switch(o.label){case 0:return[4,this.loadingController.create({spinner:"dots"})];case 1:return[4,(e=o.sent()).present()];case 2:return o.sent(),(n=new h.f).createdByUserId=this.auth.user.uid,n.entityPrimaryKey=this.advert.primaryKey,n.entityType=h.i.Advert,n.userIds=[this.auth.user.uid,t],this.chatClient.createChat(n).subscribe((function(t){return y(r,void 0,void 0,(function(){return C(this,(function(e){return this.navController.navigateRoot("chat/"+t.primaryKey),[2]}))}))})).add((function(){return y(r,void 0,void 0,(function(){return C(this,(function(t){switch(t.label){case 0:return[4,e.dismiss()];case 1:return t.sent(),[2]}}))}))})),[2]}}))}))},t.prototype.presentHelpAlert=function(){return y(this,void 0,void 0,(function(){return C(this,(function(t){switch(t.label){case 0:return[4,this.alertController.create({message:"<strong>Reply</strong> \n      <p>Leave a public response</p> \n      <strong>Arrange pickup</strong> \n      <p>Open a private conversation to arrange a pickup</p>",buttons:["Close"]})];case 1:return[4,t.sent().present()];case 2:return t.sent(),[2]}}))}))},t.prototype.showCommentHelp=function(){this.presentHelpAlert()},t.prototype.openUserProfile=function(t){this.navController.navigateForward("user-profile/"+t)},t.prototype.postReply=function(t,e,n){return y(this,void 0,void 0,(function(){var r,o,i=this;return C(this,(function(c){switch(c.label){case 0:return[4,this.loadingController.create({message:"Please wait...",translucent:!0})];case 1:return r=c.sent(),(o=new h.g).text=n,o.parentFullSlug=e.fullSlug,o.entityPrimaryKey=t,o.userId=this.auth.user.uid,o.messageType=h.q.Comment,o.entityType=h.i.Advert,r.present(),this.messageClient.post(o).subscribe((function(t){var e=new h.p;e.user=i.auth.user,e.message=t,i.advertComments.push(e),i.advertComments.sort((function(t,e){return t.message.fullSlug>e.message.fullSlug?1:-1})),console.log("New comment id: "+t),r.dismiss()}),(function(t){console.log("error submitting comment",t),r.dismiss()}),(function(){})),[2]}}))}))},t.prototype.ngAfterViewInit=function(){},t.prototype.presentReplyPopup=function(t){return y(this,void 0,void 0,(function(){var e=this;return C(this,(function(n){switch(n.label){case 0:return[4,this.alertController.create({header:"Reply to "+t.user.givenName,inputs:[{name:"reply",type:"text",placeholder:"Reply..."}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(){console.log("Confirm Cancel")}},{text:"Send reply",handler:function(n){return y(e,void 0,void 0,(function(){return C(this,(function(e){switch(e.label){case 0:return n?(console.log(n.reply),[4,this.postReply(this.advert.primaryKey,t.message,n.reply)]):[2];case 1:return e.sent(),console.log("Reply sent"),[2]}}))}))}}]})];case 1:return[4,n.sent().present()];case 2:return n.sent(),[2]}}))}))},t.\u0275fac=function(e){return new(e||t)(a.Yb(c.db),a.Yb(l.a),a.Yb(c.cb),a.Yb(u.a),a.Yb(g.a),a.Yb(c.ab),a.Yb(c.b),a.Yb(h.n),a.Yb(h.e))},t.\u0275cmp=a.Sb({type:t,selectors:[["app-comments"]],viewQuery:function(t,e){var n;1&t&&(a.Oc(M,!0),a.Oc(w,!0)),2&t&&(a.Bc(n=a.mc())&&(e.commentinput=n.first),a.Bc(n=a.mc())&&(e.replyInputs=n))},inputs:{advert:"advert",user:"user",advertComments:"advertComments",commentUsers:"commentUsers",showReply:"showReply"},decls:1,vars:1,consts:[["class","comments",4,"ngIf"],[1,"comments"],[4,"ngFor","ngForOf"],["class","comment-wrapper",4,"ngIf"],[1,"comment-wrapper"],[1,"comment",3,"ngClass"],[3,"messageMultiLine","focus","messageReply","imageUrl","title","message",4,"ngIf"],[1,"comment-buttons",2,"margin-left","4rem"],["size","small","fill","clear","style","text-transform: capitalize",3,"click",4,"ngIf"],["slot","end","size","small","fill","clear","style","text-transform: capitalize",3,"click",4,"ngIf"],[3,"messageMultiLine","focus","messageReply","imageUrl","title","message"],["size","small","fill","clear",2,"text-transform","capitalize",3,"click"],["slot","end","size","small","fill","clear",2,"text-transform","capitalize",3,"click"],["name","information-circle-outline",2,"margin-right","0.5em"]],template:function(t,e){1&t&&a.Jc(0,x,2,1,"div",0),2&t&&a.vc("ngIf",e.advertComments&&e.advertComments.length>0)},directives:[r.l,r.k,r.j,b.a,c.j,c.t],styles:[".comments[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:1.1em;font-weight:500}.comments[_ngcontent-%COMP%]   .comment-wrapper[_ngcontent-%COMP%]{margin-bottom:2em}.comments[_ngcontent-%COMP%]   .replypadding[_ngcontent-%COMP%]{margin-left:3em}.comments[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]{margin-top:.5em;margin-bottom:.5em;position:relative;display:block}.comments[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]   .comment-time[_ngcontent-%COMP%]{font-size:.7em;text-align:right}.comments[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]   .comment-details-wrapper[_ngcontent-%COMP%]{margin-left:5em;margin-right:1em}.comments[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]   .comment-details-wrapper[_ngcontent-%COMP%]   .comment-details[_ngcontent-%COMP%]{border:1px solid;border-color:var(--ion-color-primary-tint);padding:1em 1em 1em 2em;border-radius:1em}.comments[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]   circle-image[_ngcontent-%COMP%]{position:absolute;left:0;top:0;padding:0;margin:0}.comments[_ngcontent-%COMP%]   .reply-form[_ngcontent-%COMP%]{position:relative}.comments[_ngcontent-%COMP%]   .reply-form[_ngcontent-%COMP%]   .reply-form-input[_ngcontent-%COMP%]{margin-right:4em}.comments[_ngcontent-%COMP%]   .reply-form[_ngcontent-%COMP%]   .reply-form-button-wrapper[_ngcontent-%COMP%]{position:absolute;top:0;right:0}.comments[_ngcontent-%COMP%]   .reply-comment[_ngcontent-%COMP%]{position:relative;margin-top:.5em;margin-bottom:.5em}.comments[_ngcontent-%COMP%]   .reply-comment[_ngcontent-%COMP%]   .comment-time[_ngcontent-%COMP%]{font-size:.7em;text-align:left}.comments[_ngcontent-%COMP%]   .reply-comment[_ngcontent-%COMP%]   .comment-details-wrapper[_ngcontent-%COMP%]{border:1px solid;border-color:var(--ion-color-primary-tint);color:var(--ion-color-primary);text-align:right;margin-right:5em;margin-left:1em;padding:1em 2em 1em 1em;border-radius:1em}.comments[_ngcontent-%COMP%]   .reply-comment[_ngcontent-%COMP%]   circle-image[_ngcontent-%COMP%]{position:absolute;right:0;top:0;width:5em;padding:0;margin:0}"]}),t}(),K=n("Mm/0"),R=n("iHZU"),U=n("EZtS"),D=n("9B06"),E=n("bCQN"),T=function(){return(T=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},J=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((r=r.apply(t,e||[])).next())}))},B=function(t,e){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((o=(o=c.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Y=["content"],z=["commentinput"];function q(t,e){1&t&&(a.dc(0,"div"),a.Kc(1," Loading... "),a.cc())}function L(t,e){1&t&&(a.dc(0,"div"),a.dc(1,"p"),a.Kc(2,"Advert no longer exists..."),a.cc(),a.cc())}function G(t,e){if(1&t){var n=a.ec();a.dc(0,"ion-icon",23),a.lc("click",(function(){return a.Dc(n),a.pc(2).openEditPage()})),a.cc()}}function Z(t,e){if(1&t){var n=a.ec();a.dc(0,"ion-icon",24),a.lc("click",(function(){return a.Dc(n),a.pc(2).share()})),a.cc()}}function N(t,e){if(1&t){var n=a.ec();a.dc(0,"ion-icon",24),a.lc("click",(function(){return a.Dc(n),a.pc(2).copyUrl()})),a.cc()}}function j(t,e){if(1&t){var n=a.ec();a.dc(0,"ion-icon",25),a.lc("click",(function(){a.Dc(n);var t=a.pc(2);return t.deleteFavourite(t.advert)})),a.cc()}}function H(t,e){if(1&t){var n=a.ec();a.dc(0,"ion-icon",26),a.lc("click",(function(){a.Dc(n);var t=a.pc(2);return t.addFavourite(t.advert)})),a.cc()}}function Q(t,e){if(1&t){var n=a.ec();a.dc(0,"ion-icon",26),a.lc("click",(function(){return a.Dc(n),a.pc(2).goToLogin()})),a.cc()}}function X(t,e){if(1&t&&(a.dc(0,"ion-slide"),a.Zb(1,"img",29),a.cc()),2&t){var n=e.$implicit;a.Mb(1),a.vc("src",n.url,a.Ec)}}function $(t,e){if(1&t&&(a.dc(0,"div"),a.dc(1,"ion-slides",27),a.Jc(2,X,2,1,"ion-slide",28),a.cc(),a.cc()),2&t){var n=a.pc(2);a.Mb(1),a.vc("options",n.slideOpts),a.Mb(1),a.vc("ngForOf",null==n.advert?null:n.advert.images)}}function V(t,e){if(1&t&&(a.dc(0,"div"),a.dc(1,"ion-slides",30),a.dc(2,"ion-slide"),a.Zb(3,"img",29),a.qc(4,"advertImageUrl"),a.cc(),a.cc(),a.cc()),2&t){var n=a.pc(2);a.Mb(1),a.vc("options",n.slideOpts),a.Mb(2),a.vc("src",a.rc(4,2,n.advert.category),a.Ec)}}function W(t,e){if(1&t&&a.Zb(0,"app-map",31,32),2&t){var n=a.pc(2);a.vc("lat",n.lat)("lng",n.lng)("radius",3)("disableDefaultUI",!0)("draggable",!1)("disableNavigation",!1)}}function tt(t,e){1&t&&a.Zb(0,"ion-icon",41)}function et(t,e){1&t&&a.Zb(0,"ion-icon",42)}function nt(t,e){1&t&&a.Zb(0,"ion-spinner",43)}function rt(t,e){if(1&t){var n=a.ec();a.dc(0,"form",33),a.lc("ngSubmit",(function(){a.Dc(n);var t=a.pc(2);return t.postComment(t.advert.partitionKey)})),a.dc(1,"ion-item"),a.dc(2,"ion-label",34),a.Kc(3,"Request item or ask a question..."),a.cc(),a.dc(4,"ion-input",35,36),a.lc("ionBlur",(function(){return a.Dc(n),a.pc(2).commentInputBlur()}))("ionFocus",(function(){return a.Dc(n),a.pc(2).commentInputFocus()})),a.cc(),a.dc(6,"ion-button",37),a.Jc(7,tt,1,0,"ion-icon",38),a.Jc(8,et,1,0,"ion-icon",39),a.cc(),a.Jc(9,nt,1,0,"ion-spinner",40),a.cc(),a.cc()}if(2&t){var r=a.pc(2);a.vc("formGroup",r.postCommentForm),a.Mb(7),a.vc("ngIf",!r.postCommentForm.valid&&!r.posting),a.Mb(1),a.vc("ngIf",r.postCommentForm.valid&&!r.posting),a.Mb(1),a.vc("ngIf",r.posting)}}function ot(t,e){if(1&t&&a.Zb(0,"app-comments",44),2&t){var n=a.pc(2);a.vc("advert",n.advert)("user",n.advertOwner)("showReply",!0)("advertComments",n.advertComments)}}function it(t,e){if(1&t){var n=a.ec();a.dc(0,"div"),a.dc(1,"a",45),a.lc("click",(function(){return a.Dc(n),a.pc(2).loadReportPage()})),a.Kc(2,"Report"),a.cc(),a.cc()}}function ct(t,e){if(1&t){var n=a.ec();a.dc(0,"div"),a.dc(1,"ion-refresher",5),a.lc("ionRefresh",(function(t){return a.Dc(n),a.pc().refresh(t)})),a.Zb(2,"ion-refresher-content"),a.cc(),a.dc(3,"div",6),a.dc(4,"div",7),a.Jc(5,G,1,0,"ion-icon",8),a.cc(),a.dc(6,"div",9),a.Jc(7,Z,1,0,"ion-icon",10),a.Jc(8,N,1,0,"ion-icon",10),a.Jc(9,j,1,0,"ion-icon",11),a.qc(10,"favourite"),a.Jc(11,H,1,0,"ion-icon",12),a.qc(12,"favourite"),a.Jc(13,Q,1,0,"ion-icon",12),a.cc(),a.cc(),a.dc(14,"div",13),a.dc(15,"h1"),a.Kc(16),a.cc(),a.Jc(17,$,3,2,"div",3),a.Jc(18,V,5,4,"div",3),a.dc(19,"ion-item",14),a.dc(20,"div",15),a.dc(21,"app-message",16),a.lc("click",(function(){a.Dc(n);var t=a.pc();return t.openUserProfile(null==t.auth||null==t.auth.user?null:t.auth.user.uid)})),a.qc(22,"date"),a.cc(),a.Zb(23,"app-rating",17),a.cc(),a.cc(),a.Zb(24,"div"),a.dc(25,"p"),a.Kc(26),a.cc(),a.cc(),a.dc(27,"div",18),a.Jc(28,W,2,6,"app-map",19),a.cc(),a.Jc(29,rt,10,4,"form",20),a.Jc(30,ot,1,4,"app-comments",21),a.dc(31,"ion-item",22),a.Jc(32,it,3,0,"div",3),a.cc(),a.cc()}if(2&t){var r=a.pc();a.Mb(5),a.vc("ngIf",(null==r.auth.user?null:r.auth.user.uid)==r.advert.userId),a.Mb(2),a.vc("ngIf",r.canShare),a.Mb(1),a.vc("ngIf",r.copyUrlShare),a.Mb(1),a.vc("ngIf",(null==r.auth?null:r.auth.user)&&a.sc(10,23,null==r.advert?null:r.advert.primaryKey,r.favouriteService.userFavouriteAdvertIds)),a.Mb(2),a.vc("ngIf",(null==r.auth?null:r.auth.user)&&!a.sc(12,26,null==r.advert?null:r.advert.primaryKey,r.favouriteService.userFavouriteAdvertIds)),a.Mb(2),a.vc("ngIf",!r.auth.user),a.Mb(3),a.Lc(r.advert.title),a.Mb(1),a.vc("ngIf",null==r.advert?null:r.advert.images),a.Mb(1),a.vc("ngIf",!(null!=r.advert&&r.advert.images)),a.Mb(3),a.xc("tinyTitle","",r.expiresText," ",a.rc(22,29,r.expiryDate),""),a.vc("title",null==r.advertOwner?null:r.advertOwner.name)("imageUrl",null==r.advertOwner?null:r.advertOwner.pictureUrl),a.Mb(2),a.vc("showBadge",!0)("showStars",!0)("readonly",!0)("rating",r.rating),a.Mb(3),a.Lc(r.advert.description),a.Mb(1),a.vc("hidden",!r.advert.geoLocation||!r.advert.geoLocation.lat||!r.advert.geoLocation.lng),a.Mb(1),a.vc("ngIf",r.lat&&r.lng),a.Mb(1),a.vc("ngIf",r.auth.authenticated&&r.advert.status===r.StatusEnum.Open),a.Mb(1),a.vc("ngIf",r.advert.partitionKey&&r.advertComments.length>0),a.Mb(2),a.vc("ngIf",r.auth.user)}}function at(t,e){if(1&t){var n=a.ec();a.dc(0,"ion-button",51),a.lc("click",(function(){return a.Dc(n),a.pc(2).focusOnCommentInput()})),a.Kc(1,"Request"),a.cc()}}function st(t,e){if(1&t){var n=a.ec();a.dc(0,"ion-button",51),a.lc("click",(function(){return a.Dc(n),a.pc(2).goToLogin()})),a.Kc(1,"Request"),a.cc()}}function ut(t,e){if(1&t){var n=a.ec();a.dc(0,"ion-button",52),a.lc("click",(function(){return a.Dc(n),a.pc(2).openAdvertStatus()})),a.Kc(1,"Update status "),a.cc()}}function lt(t,e){if(1&t){var n=a.ec();a.dc(0,"ion-button",53),a.lc("click",(function(){return a.Dc(n),a.pc(2).openAdvertStatus()})),a.Kc(1,"no longer available"),a.cc()}}function dt(t,e){1&t&&(a.dc(0,"ion-label",54),a.Kc(1,"no longer available"),a.cc())}function pt(t,e){if(1&t&&(a.dc(0,"ion-footer",46),a.Jc(1,at,2,0,"ion-button",47),a.Jc(2,st,2,0,"ion-button",47),a.Jc(3,ut,2,0,"ion-button",48),a.Jc(4,lt,2,0,"ion-button",49),a.Jc(5,dt,2,0,"ion-label",50),a.cc()),2&t){var n=a.pc();a.Mb(1),a.vc("ngIf",n.advert.status===n.StatusEnum.Open&&n.auth.user&&(null==n.auth.user?null:n.auth.user.uid)!==n.advert.userId),a.Mb(1),a.vc("ngIf",n.advert.status===n.StatusEnum.Open&&!n.auth.user),a.Mb(1),a.vc("ngIf",(null==n.auth.user?null:n.auth.user.uid)==n.advert.userId),a.Mb(1),a.vc("ngIf",n.advert.status!=n.StatusEnum.Open&&(null==n.auth||null==n.auth.user?null:n.auth.user.uid)===(null==n.advert?null:n.advert.userId)),a.Mb(1),a.vc("ngIf",n.advert.status!=n.StatusEnum.Open&&(null==n.auth||null==n.auth.user?null:n.auth.user.uid)!==(null==n.advert?null:n.advert.userId))}}var mt=function(){function t(t,e,n,r,i,c,a,s,u,l,d,m,v,f,g){var b=this;this.navController=t,this.auth=e,this.loadingCtrl=n,this.alertCtrl=r,this.errorService=i,this.advertService=c,this.socialSharing=a,this.toastCtrl=s,this.formBuilder=u,this.favouriteService=l,this.activatedRoute=d,this.imageService=m,this.advertClient=v,this.commentClient=f,this.ratingClient=g,this.title="Advert",this.canShare=!1,this.copyUrlShare=!1,this.advertComments=[],this.commentsReady=!1,this.posting=!1,this.StatusEnum=h.x,this.expiryDate=new Date,this.baseUrl=p.a.baseUrl,this.messageSpinner=!1,this.advertDateCreated="",this.body="",this.expiresText="Expires",this.advertImagesBySize=[],this.loadingAdvert=!1,this.loadedAdvert=!1,this.slideOpts={initialSlide:1,speed:400},this.lastEvaluatedKeyHash=void 0,this.advert=new h.c,this.advert.images=[],this.postCommentForm=this.formBuilder.group({body:["",o.o.required]}),this.postCommentForm=this.formBuilder.group({body:["",o.o.required]}),this.socialSharing.canShareViaEmail().then((function(){b.canShare=!0})).catch((function(){b.canShare=!1,b.copyUrlShare=!0}))}return t.prototype.openAdvertStatus=function(){this.navController.navigateForward("advert-status/"+this.advertPrimaryKey)},t.prototype.getUserRating=function(t){var e=this;this.ratingClient.average(t.userId,h.i.Advert).subscribe((function(t){e.rating=t.averageRating?t.averageRating:0}))},t.prototype.presentToast=function(t){return J(this,void 0,void 0,(function(){return B(this,(function(e){switch(e.label){case 0:return[4,this.toastCtrl.create({message:t,duration:3e3,position:"bottom"})];case 1:return[4,e.sent().present()];case 2:return e.sent(),[2]}}))}))},t.prototype.commentInputBlur=function(){this.advertService.showFooter=!0},t.prototype.commentInputFocus=function(){this.advertService.showFooter=!1},t.prototype.ngOnInit=function(){var t=this;Object(m.b)(this.activatedRoute.params,this.activatedRoute.queryParams,(function(t,e){return T(T({},t),e)})).subscribe((function(e){t.advertPrimaryKey=e.id,t.advertPartitionKey=t.advertPrimaryKey.split("|")[0],t.advertSortKey=t.advertPrimaryKey.split("|")[1],t.loadData().then((function(){console.log("Advert "+t.advertPrimaryKey+" loaded")}))}))},t.prototype.loadData=function(){return J(this,void 0,void 0,(function(){return B(this,(function(t){switch(t.label){case 0:return this.advertComments=[],[4,this.getAdvert(this.advertPartitionKey,this.advertSortKey)];case 1:return t.sent(),this.getAdvertComments(),[2]}}))}))},t.prototype.refresh=function(t){return J(this,void 0,void 0,(function(){return B(this,(function(e){switch(e.label){case 0:return this.advertComments=[],[4,this.loadData()];case 1:return e.sent(),t.target.complete(),[2]}}))}))},t.prototype.copyUrl=function(){var t=window.location.href;f(t,{debug:!0,message:"Press #{key} to copy"}),this.presentToast("Link copied")},t.prototype.share=function(){return J(this,void 0,void 0,(function(){var t;return B(this,(function(e){switch(e.label){case 0:return[4,this.socialSharing.share("I found this on Bonobo Give... "+this.advert.title+" I found this on Bonobo Give... "+this.advert.title,null,p.a.baseUrlLive+"advert/"+this.advert.partitionKey)];case 1:return t=e.sent(),console.log(t),[2]}}))}))},t.prototype.copyShareUrl=function(){var t=p.a.baseUrlLive+"/#/advert/"+this.advert.partitionKey,e=document.createElement("input");e.setAttribute("type","hidden"),e.setAttribute("value",t),e.setAttribute("name","shareUrl"),e.setAttribute("id","shareUrl"),document.body.appendChild(e),e.select();var n=document.execCommand("copy");this.presentToast(!0===n?"Link copied":"Failed to copy share url")},t.prototype.deleteFavourite=function(){this.favouriteService.deleteFavouriteByAdvertEntity(this.advert).subscribe((function(t){}),(function(t){console.log(t)}))},t.prototype.deleteAdvert=function(t){return J(this,void 0,void 0,(function(){return B(this,(function(e){switch(e.label){case 0:return[4,this.advertClient.delete(t.partitionKey,t.sortKey)];case 1:return e.sent(),this.navController.navigateForward("my-adverts"),[2]}}))}))},t.prototype.addFavourite=function(){return J(this,void 0,void 0,(function(){return B(this,(function(t){switch(t.label){case 0:return[4,this.favouriteService.addFavourite(this.advertPrimaryKey)];case 1:return t.sent(),[2]}}))}))},t.prototype.focusOnCommentInput=function(){var t=this;setTimeout((function(){t.input.nativeElement.setFocus()}))},t.prototype.openEditPage=function(){this.navController.navigateForward("post/"+this.advertPrimaryKey)},t.prototype.openUserProfile=function(t){this.navController.navigateForward("user-profile/"+t)},t.prototype.getAdvert=function(t,e){return J(this,void 0,void 0,(function(){var n=this;return B(this,(function(r){return this.loadingAdvert=!0,this.loadedAdvert=!1,this.advertClient.get(t,e).subscribe((function(t){return J(n,void 0,void 0,(function(){return B(this,(function(e){return this.advert=t,[2]}))}))}),(function(t){console.log("Error loading advert",t),n.navController.navigateForward("home"),n.presentToast("Sorry there was an issue loading this advert")})).add((function(){n.loadingAdvert=!1,n.loadedAdvert=!0})),[2]}))}))},t.prototype.addDays=function(t,e){var n=new Date(t);return n.setDate(n.getDate()+e),n},t.prototype.scrollToBottom=function(){var t=this;setTimeout((function(){try{t.content&&t.content.scrollToBottom()}catch(e){}}))},t.prototype.postComment=function(){return J(this,void 0,void 0,(function(){var t,e=this;return B(this,(function(n){return this.posting=!0,(t=new h.g).entityPrimaryKey=this.advertPrimaryKey,t.messageType=h.q.Comment,t.text=this.postCommentForm.value.body,t.userId=this.auth.user.uid,this.commentClient.post(t).subscribe((function(){return J(e,void 0,void 0,(function(){return B(this,(function(t){switch(t.label){case 0:return this.postCommentForm.reset(),this.posting=!1,this.scrollToBottom(),[4,this.loadData()];case 1:return t.sent(),[2]}}))}))})),[2]}))}))},t.prototype.getAdvertComments=function(){var t=this;console.log("Getting advert comments");var e=new h.r;e.take=10,e.nextRequestBlob=this.lastEvaluatedKeyHash,this.advertComments=[],this.commentClient.get(this.advertPrimaryKey,h.q.Comment,e.take,e.nextRequestBlob).subscribe((function(e){var n;(n=t.advertComments).push.apply(n,e.messages)}))},t.prototype.goToLogin=function(){this.navController.navigateForward("login")},t.prototype.loadReportPage=function(){this.navController.navigateForward("report/"+this.advertPrimaryKey)},t.\u0275fac=function(e){return new(e||t)(a.Yb(c.db),a.Yb(l.a),a.Yb(c.ab),a.Yb(c.b),a.Yb(d.a),a.Yb(u.a),a.Yb(v.a),a.Yb(c.kb),a.Yb(o.b),a.Yb(s.a),a.Yb(i.a),a.Yb(g.a),a.Yb(h.b),a.Yb(h.n),a.Yb(h.t))},t.\u0275cmp=a.Sb({type:t,selectors:[["advert"]],viewQuery:function(t,e){var n;1&t&&(a.Oc(Y,!0),a.Oc(F,!0),a.Oc(z,!0,a.q)),2&t&&(a.Bc(n=a.mc())&&(e.content=n.first),a.Bc(n=a.mc())&&(e.commentsComponent=n.first),a.Bc(n=a.mc())&&(e.input=n.first))},decls:8,vars:4,consts:[["title","Adverts"],[1,"advert"],["content",""],[4,"ngIf"],["style","text-align: center","class","footer-buttons",4,"ngIf"],["slot","fixed",3,"ionRefresh"],[1,"advert-buttons"],[1,"options-left"],["class","icon edit","ios","ios-create","md","md-create",3,"click",4,"ngIf"],[1,"options-right"],["class","icon","name","share",3,"click",4,"ngIf"],["class","icon","name","heart","isActive","true","color","danger",3,"click",4,"ngIf"],["class","icon regular","name","heart-empty","isActive","false",3,"click",4,"ngIf"],[1,"ion-padding"],["lines","none",1,"ion-no-padding"],["slot","start"],[3,"title","imageUrl","tinyTitle","click"],[3,"showBadge","showStars","readonly","rating"],[3,"hidden"],[3,"lat","lng","radius","disableDefaultUI","draggable","disableNavigation",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"advert","user","showReply","advertComments",4,"ngIf"],[1,"ion-text-right"],["ios","ios-create","md","md-create",1,"icon","edit",3,"click"],["name","share",1,"icon",3,"click"],["name","heart","isActive","true","color","danger",1,"icon",3,"click"],["name","heart-empty","isActive","false",1,"icon","regular",3,"click"],["pager","true",3,"options"],[4,"ngFor","ngForOf"],[3,"src"],["pager","false",3,"options"],[3,"lat","lng","radius","disableDefaultUI","draggable","disableNavigation"],["mapComponent",""],[3,"formGroup","ngSubmit"],["position","floating"],["id","maincommentinput","type","text","formControlName","body","maxlength","250",3,"ionBlur","ionFocus"],["commentinput",""],["size","large","slot","end","fill","clear","type","submit",1,"ion-no-padding"],["class","send-button-disabled","name","send",4,"ngIf"],["slot","end","class","send-button","name","send",4,"ngIf"],["slot","end","class","ion-spinner-postsmessage",4,"ngIf"],["name","send",1,"send-button-disabled"],["slot","end","name","send",1,"send-button"],["slot","end",1,"ion-spinner-postsmessage"],[3,"advert","user","showReply","advertComments"],[1,"report",3,"click"],[1,"footer-buttons",2,"text-align","center"],["color","primary","button-default","","block","",3,"click",4,"ngIf"],["button-default","","block","",3,"click",4,"ngIf"],["fill","clear","color","dark",3,"click",4,"ngIf"],["size","large","fill","clear","color","dark",4,"ngIf"],["color","primary","button-default","","block","",3,"click"],["button-default","","block","",3,"click"],["fill","clear","color","dark",3,"click"],["size","large","fill","clear","color","dark"]],template:function(t,e){1&t&&(a.dc(0,"ion-header"),a.Zb(1,"app-topbar",0),a.cc(),a.dc(2,"ion-content",1,2),a.Jc(4,q,2,0,"div",3),a.Jc(5,L,3,0,"div",3),a.Jc(6,ct,33,31,"div",3),a.cc(),a.Jc(7,pt,6,5,"ion-footer",4)),2&t&&(a.Mb(4),a.vc("ngIf",e.loadingAdvert),a.Mb(1),a.vc("ngIf",e.loadedAdvert&&!e.advert),a.Mb(1),a.vc("ngIf",e.loadedAdvert&&e.advert),a.Mb(1),a.vc("ngIf",e.advert&&e.advertService.showFooter))},directives:[c.s,K.a,c.p,r.l,c.H,c.I,c.y,b.a,R.a,c.t,c.R,r.k,c.Q,U.a,o.q,o.i,o.d,c.z,c.x,c.jb,o.h,o.c,o.f,c.j,c.S,F,c.q],pipes:[D.a,r.e,E.a],styles:[".footer-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{text-transform:none!important}.advert[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-top:0;padding-top:0;color:#554749}.advert[_ngcontent-%COMP%]   .send-button[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.advert[_ngcontent-%COMP%]   .send-button-disabled[_ngcontent-%COMP%]{color:grey}.advert[_ngcontent-%COMP%]   .report[_ngcontent-%COMP%]{font-size:1.2em}.advert[_ngcontent-%COMP%]   .ion-spinner-postmessage[_ngcontent-%COMP%]{stroke:#fff}.advert[_ngcontent-%COMP%]   .advert-buttons[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;z-index:2;height:4em}.advert[_ngcontent-%COMP%]   .advert-buttons[_ngcontent-%COMP%]   .options-left[_ngcontent-%COMP%]{position:absolute;top:1em;left:0;z-index:1;margin-left:.25em}.advert[_ngcontent-%COMP%]   .advert-buttons[_ngcontent-%COMP%]   .options-right[_ngcontent-%COMP%]{position:absolute;top:1em;right:0;z-index:1}.advert[_ngcontent-%COMP%]   .advert-buttons[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);opacity:1%;font-size:1.4em;border-radius:50%;padding:.5em;color:#fff;margin-right:.25em}.advert[_ngcontent-%COMP%]   .user-rating-rate[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]{padding:0;margin:0}.advert[_ngcontent-%COMP%]   .user-rating-rate[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], .advert[_ngcontent-%COMP%]   .user-rating-rate[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:0!important;margin:0!important}.advert[_ngcontent-%COMP%]   .user-rating-rate[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#00613a!important}"]}),t}(),vt=n("j1ZV"),ft=n("iTUp"),gt=[{path:"",component:mt,data:{preload:!0}}],ht=function(){function t(){}return t.\u0275mod=a.Wb({type:t}),t.\u0275inj=a.Vb({factory:function(e){return new(e||t)},imports:[[r.c,o.e,o.m,c.Y,i.k.forChild(gt),vt.a,ft.a]]}),t}()},bCQN:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n("Xd5C"),o=n("TYT/"),i=function(){function t(){}return t.prototype.transform=function(t){return this.getAdvertCategoryImage(t)},t.prototype.getAdvertCategoryImage=function(t){var e="";switch(t){case r.d.First:e="assets/images/categories/FirstComeFirstServed.svg";break;case r.d.All:e="assets/images/categories/all.svg";break;case r.d.Fashion:e="assets/images/categories/FashionAndAccessories.svg";break;case r.d.Baby:e="assets/images/categories/BabyAndChild.svg";break;case r.d.Sport:e="assets/images/categories/SportAndLeisure.svg";break;case r.d.Free:e="assets/images/categories/FreeService.svg";break;case r.d.Home:e="assets/images/categories/HomeAndGarden.svg";break;case r.d.Media:e="assets/images/categories/MovieAndBook.svg";break;case r.d.Pet:e="assets/images/categories/PetAccessories.svg";break;case r.d.Motor:e="assets/images/categories/MotorsAndAccessories.svg";break;default:e="assets/images/no-image.png"}return e},t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=o.Xb({name:"advertImageUrl",type:t,pure:!0}),t}()},mveN:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n("lGQG"),o=n("i5GC"),i=n("Xd5C"),c=n("xMyE"),a=n("TYT/"),s=function(){function t(t,e,n){this.advertService=t,this.auth=e,this.advertClient=n,this.userFavouriteAdvertIds=[],this.userFavourites()}return t.prototype.userFavourites=function(){var t=this;if(this.auth&&this.auth.user&&this.auth.user.uid){var e=new i.r;e.nextRequestBlob=void 0,e.take=1e3,this.advertClient.favouritesAdverts(this.auth.user.uid,e).subscribe((function(e){t.userFavouriteAdvertIds=e.entities}))}},t.prototype.addFavourite=function(t){return e=this,void 0,r=function(){var e,n,r=this;return function(t,e){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((o=(o=c.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}(this,(function(o){return e=t+this.auth.user.uid,(n=new i.j).primaryKey=e,n.entityPrimaryKey=t,this.userFavouriteAdvertIds.push(n),this.advertClient.addFavourite(t,this.auth.user.uid).subscribe((function(t){var e=r.userFavouriteAdvertIds.findIndex((function(e){return e.entityPrimaryKey===t.entityPrimaryKey}));-1!==e?(r.userFavouriteAdvertIds[e]=t,console.log("Advert added "+t)):console.log("Couldn't find array to update")})),[2]}))},new((n=void 0)||(n=Promise))((function(t,o){function i(t){try{a(r.next(t))}catch(e){o(e)}}function c(t){try{a(r.throw(t))}catch(e){o(e)}}function a(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n((function(t){t(r)}))).then(i,c)}a((r=r.apply(e,[])).next())}));var e,n,r},t.prototype.deleteFavouriteByAdvertEntity=function(t){var e=this;return this.advertClient.deleteFavourite(this.auth.user.uid,t.primaryKey).pipe(Object(c.a)((function(n){e.userFavouriteAdvertIds=e.userFavouriteAdvertIds.filter((function(e){return e.entityPrimaryKey!==t.primaryKey})),console.log("Favourite for advert "+t.primaryKey+" deleted")})))},t.\u0275fac=function(e){return new(e||t)(a.hc(o.a),a.hc(r.a),a.hc(i.b))},t.\u0275prov=a.Ub({token:t,factory:t.\u0275fac,providedIn:"root"}),t}()}}]);