(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{"17gG":function(t,e,n){"use strict";n.r(e),n.d(e,"RatingPageModule",(function(){return P}));var r=n("Valr"),a=n("QJY3"),i=n("DUip"),o=n("c7TG"),c=n("dzgT"),s=n("Xd5C"),u=n("QSUi"),d=n("TYT/"),l=n("Mm/0"),g=n("5j9j"),p=function(){return(p=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},f=function(t,e,n,r){return new(n||(n=Promise))((function(a,i){function o(t){try{s(r.next(t))}catch(e){i(e)}}function c(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((r=r.apply(t,e||[])).next())}))},v=function(t,e){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(c){i=[6,c],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};function b(t,e){1&t&&(d.dc(0,"span"),d.Kc(1,"Submit rating"),d.cc())}function h(t,e){1&t&&(d.dc(0,"span"),d.Kc(1,"Update rating"),d.cc())}function y(t,e){if(1&t){var n=d.ec();d.dc(0,"div"),d.Zb(1,"app-message",4),d.Zb(2,"app-message",4),d.Zb(3,"app-rate",5),d.dc(4,"ion-button",6),d.lc("click",(function(){return d.Dc(n),d.pc().submitRating()})),d.Jc(5,b,2,0,"span",3),d.Jc(6,h,2,0,"span",3),d.cc(),d.cc()}if(2&t){var r=d.pc();d.Mb(1),d.vc("message",r.advert.title),d.Mb(1),d.vc("message",r.ratedUser.username),d.Mb(1),d.vc("advertId",r.advertPrimaryKey)("ratedUserId",r.ratedUserId)("showRatingsCount",r.showRatingsCount)("reviewerUserId",r.ratingUserId)("getReviewerRating",r.getReviewerRating)("getAverageUserRating",r.getAverageUserRating)("readOnlyRating",r.readOnlyRating),d.Mb(1),d.vc("disabled",!(null!=r.rateComponent&&r.rateComponent.ratingComplete)),d.Mb(1),d.vc("ngIf",!(null!=r.rateComponent&&r.rateComponent.foundPreviousRating)),d.Mb(1),d.vc("ngIf",null==r.rateComponent?null:r.rateComponent.foundPreviousRating)}}function m(t,e){1&t&&(d.dc(0,"div"),d.Kc(1,"Loading..."),d.cc())}var C=function(){function t(t,e,n,r,a,i){this.activatedRoute=t,this.ratingClient=e,this.advertClient=n,this.userClient=r,this.loadingController=a,this.navController=i,this.showRatingsCount=!1,this.getReviewerRating=!0,this.getAverageUserRating=!1,this.readOnlyRating=!1,this.loading=!1,this.ratingSpinner=!1}return t.prototype.ngOnInit=function(){var t=this;this.loading=!0,this.rating=new s.u,this.rating.ratingBreakdown=new s.s,Object(c.b)(this.activatedRoute.params,this.activatedRoute.queryParams,(function(t,e){return p(p({},t),e)})).subscribe((function(e){t.advertPrimaryKey=e.advertPrimaryKey,t.advertPartitionKey=t.advertPrimaryKey.split("|")[0],t.advertSortKey=t.advertPrimaryKey.split("|")[1],t.ratedUserId=e.ratedUserId,t.ratingUserId=e.ratingUserId;var n=t.advertClient.get(t.advertPartitionKey,t.advertSortKey),r=t.userClient.get(t.ratedUserId,!0);Object(c.b)(n,r).subscribe((function(e){t.advert=e[0],t.ratedUser=e[1],console.log("Got advert and user",e)})).add((function(){t.loading=!1}))}))},t.prototype.submitRating=function(){return f(this,void 0,void 0,(function(){var t,e,n,r=this;return v(this,(function(a){switch(a.label){case 0:return t=this.rateComponent.createRatingRequest(),e=this.ratingClient.post(t),[4,this.loadingController.create({message:"Please wait..."})];case 1:return[4,(n=a.sent()).present()];case 2:return a.sent(),e.subscribe((function(e){console.log("rated user "+t.ratedUserId,e)})).add((function(){return f(r,void 0,void 0,(function(){return v(this,(function(t){switch(t.label){case 0:return[4,n.dismiss()];case 1:return t.sent(),this.navController.navigateRoot("advert/"+this.advert.primaryKey),[2]}}))}))})),[2]}}))}))},t.\u0275fac=function(e){return new(e||t)(d.Yb(i.a),d.Yb(s.t),d.Yb(s.b),d.Yb(s.z),d.Yb(o.ab),d.Yb(o.db))},t.\u0275cmp=d.Sb({type:t,selectors:[["app-rating"]],viewQuery:function(t,e){var n;1&t&&d.Oc(u.a,!0),2&t&&d.Bc(n=d.mc())&&(e.rateComponent=n.first)},decls:6,vars:2,consts:[["title","Notifications"],[1,"Rate","user"],[1,"rate-user"],[4,"ngIf"],[3,"message"],[3,"advertId","ratedUserId","showRatingsCount","reviewerUserId","getReviewerRating","getAverageUserRating","readOnlyRating"],["expand","block",3,"disabled","click"]],template:function(t,e){1&t&&(d.dc(0,"ion-header"),d.Zb(1,"app-topbar",0),d.cc(),d.dc(2,"ion-content",1),d.dc(3,"div",2),d.Jc(4,y,7,12,"div",3),d.Jc(5,m,2,0,"div",3),d.cc(),d.cc()),2&t&&(d.Mb(4),d.vc("ngIf",!e.loading&&e.ratedUserId&&e.ratingUserId),d.Mb(1),d.vc("ngIf",e.loading))},directives:[o.s,l.a,o.p,r.l,g.a,u.a,o.j],styles:[".rate-user[_ngcontent-%COMP%]{background-color:#fff;height:100%;top:0;bottom:0}.rate-user[_ngcontent-%COMP%]   ul.rating[_ngcontent-%COMP%]{text-align:center;padding:0!important;margin:0!important}.rate-user[_ngcontent-%COMP%]   .rating-title[_ngcontent-%COMP%]{text-align:center;padding:0;margin:0}.rate-user[_ngcontent-%COMP%]   .star[_ngcontent-%COMP%]{font-size:20px;display:block}.rate-user[_ngcontent-%COMP%]   .star[_ngcontent-%COMP%]   .ion-md-star[_ngcontent-%COMP%]{color:green}.rate-user[_ngcontent-%COMP%]   .star[_ngcontent-%COMP%]   .ion-md-star-outline[_ngcontent-%COMP%]{color:grey}"]}),t}(),w=n("j1ZV"),R=[{path:"",component:C}],P=function(){function t(){}return t.\u0275mod=d.Wb({type:t}),t.\u0275inj=d.Vb({factory:function(e){return new(e||t)},imports:[[r.c,a.e,o.Y,i.k.forChild(R),w.a]]}),t}()}}]);