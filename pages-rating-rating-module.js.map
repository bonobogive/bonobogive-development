{"version":3,"sources":["./src/app/pages/rating/rating.module.ts","./src/app/pages/rating/rating.page.ts","./src/app/pages/rating/rating.page.html"],"names":[],"mappings":"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","file":"pages-rating-rating-module.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { RatingPage } from './rating.page';\r\nimport { ComponentsModule } from '../../components/components.module';\r\nimport { StarRatingModule, StarRatingComponent } from 'angular-star-rating';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: RatingPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    RouterModule.forChild(routes),\r\n    ComponentsModule\r\n  ],\r\n  declarations: [RatingPage]\r\n})\r\nexport class RatingPageModule {}\r\n","import { Component, OnInit, ViewChild } from '@angular/core';\r\n// import { FirebaseService } from '../../services/firebase.service';\r\nimport { NavController, NavParams, ModalController, LoadingController } from '@ionic/angular';\r\nimport { ClickEvent } from 'angular-star-rating';\r\nimport { combineLatest } from 'rxjs';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { RatingEntity, IRatingEntity, RatingBreakdown, EntityTypeEnum, RatingClient, AdvertClient, AdvertEntity, UserClient, UserModel } from '../../clients/bonobogive.client';\r\nimport { getAttrsForDirectiveMatching } from '@angular/compiler/src/render3/view/util';\r\nimport { stringify } from 'querystring';\r\nimport { RateComponent } from '../../components/rate/rate.component';\r\n\r\n@Component({\r\n  selector: 'app-rating',\r\n  templateUrl: './rating.page.html',\r\n  styleUrls: ['./rating.page.scss'],\r\n})\r\nexport class RatingPage implements OnInit {\r\n\r\n  ratedUserId: string;\r\n  advertPrimaryKey: string;\r\n  advertPartitionKey: string;\r\n  advertSortKey: string;\r\n  showRatingsCount: boolean = false;\r\n  ratingUserId: string;\r\n  getReviewerRating: boolean = true;\r\n  getAverageUserRating: boolean = false;\r\n  readOnlyRating: boolean = false;\r\n  rating: RatingEntity;\r\n  loading: boolean = false;\r\n\r\n  advert: AdvertEntity;\r\n\r\n  ratedUser: UserModel;\r\n\r\n  ratingSpinner = false;\r\n\r\n  @ViewChild(RateComponent) rateComponent: RateComponent;\r\n\r\n  constructor(\r\n    private activatedRoute: ActivatedRoute,\r\n    public ratingClient: RatingClient,\r\n    public advertClient: AdvertClient,\r\n    public userClient: UserClient,\r\n    public loadingController: LoadingController,\r\n    private navController: NavController) { }\r\n\r\n  ngOnInit() {\r\n    this.loading = true;\r\n    this.rating = new RatingEntity();\r\n    this.rating.ratingBreakdown = new RatingBreakdown();\r\n\r\n    const urlParams = combineLatest(\r\n      this.activatedRoute.params,\r\n      this.activatedRoute.queryParams,\r\n      (params, queryParams) => ({ ...params, ...queryParams })\r\n    );\r\n\r\n    urlParams.subscribe(routeParams => {\r\n      this.advertPrimaryKey = routeParams.advertPrimaryKey;\r\n\r\n      this.advertPartitionKey = this.advertPrimaryKey.split(\"|\")[0];\r\n      this.advertSortKey = this.advertPrimaryKey.split(\"|\")[1];\r\n      this.ratedUserId = routeParams.ratedUserId;\r\n      this.ratingUserId = routeParams.ratingUserId;\r\n\r\n      var advertObservable = this.advertClient.get(this.advertPartitionKey, this.advertSortKey);\r\n      var userObservable = this.userClient.get(this.ratedUserId, true);\r\n\r\n      var combined = combineLatest(advertObservable, userObservable);\r\n\r\n      combined.subscribe(res => {\r\n        this.advert = res[0];\r\n        this.ratedUser = res[1];\r\n        console.log(\"Got advert and user\", res);\r\n      })\r\n        .add(() => {\r\n          this.loading = false;\r\n        });\r\n    });\r\n  }\r\n\r\n\r\n  async submitRating() {\r\n\r\n    var ratingRequest = this.rateComponent.createRatingRequest();\r\n\r\n    var ratingObservable = this.ratingClient.post(ratingRequest);\r\n\r\n    const loading = await this.loadingController.create({\r\n      message: 'Please wait...'\r\n    });\r\n    await loading.present();\r\n\r\n    ratingObservable.subscribe(res => {\r\n      console.log(`rated user ${ratingRequest.ratedUserId}`, res);\r\n    }).add(async () => {\r\n      await loading.dismiss();\r\n      this.navController.navigateRoot(`advert/${this.advert.primaryKey}`);\r\n    })\r\n  }\r\n\r\n\r\n}\r\n","<ion-header>\r\n    <app-topbar title=\"Notifications\"></app-topbar>\r\n  </ion-header>\r\n  <ion-content class=\"ion-no-padding\" class=\"Rate user\">\r\n<div class=\"rate-user\">\r\n    <div *ngIf=\"!loading && ratedUserId && ratingUserId\">\r\n\r\n\r\n        <app-message [message]=\"advert.title\"></app-message>\r\n        <app-message [message]=\"ratedUser.username\"></app-message>\r\n\r\n        <app-rate [advertId]=\"advertPrimaryKey\" [ratedUserId]=\"ratedUserId\"\r\n        [showRatingsCount]=\"showRatingsCount\"\r\n        [reviewerUserId]=\"ratingUserId\"\r\n        [getReviewerRating]=\"getReviewerRating\"\r\n        [getAverageUserRating]=\"getAverageUserRating\"\r\n        [readOnlyRating]=\"readOnlyRating\"></app-rate>\r\n\r\n        <ion-button expand=\"block\" [disabled]=\"!rateComponent?.ratingComplete\" (click)=\"submitRating()\">\r\n            <span *ngIf=\"!rateComponent?.foundPreviousRating\">Submit rating</span>\r\n            <span *ngIf=\"rateComponent?.foundPreviousRating\">Update rating</span>\r\n        </ion-button>\r\n    </div>\r\n    <div *ngIf=\"loading\">Loading...</div>\r\n</div>\r\n\r\n\r\n\r\n</ion-content>"],"sourceRoot":"webpack:///"}